(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[21320],{418450:(t,e,i)=>{"use strict";i.d(e,{TranslatedString:()=>s});class s{constructor(t,e){this._originalText=t,this._translatedText=e}originalText(){return this._originalText}translatedText(){return this._translatedText}format(t){const e={},i={};for(const n of Object.keys(t)){const r=t[n];r instanceof s?(e[n]=r.originalText(),i[n]=r.translatedText()):(e[n]=r.toString(),i[n]=r.toString())}const n=this._originalText.format(e),r=this._translatedText.format(i);return new s(n,r)}}},886338:(t,e,i)=>{"use strict";i.d(e,{Version:()=>n});var s=i(650151);class n{constructor(t,e){this._major=t,this._minor=e}major(){return this._major}minor(){return this._minor}isZero(){return 0===this._major&&0===this._minor}toString(){return this._major+"."+this._minor}compareTo(t){return this._major<t._major?-1:this._major>t._major?1:this._minor<t._minor?-1:this._minor>t._minor?1:0}isLess(t){return this.compareTo(t)<0}isLessOrEqual(t){return this.compareTo(t)<=0}isEqual(t){return 0===this.compareTo(t)}isGreater(t){return this.compareTo(t)>0}isGreaterOrEqual(t){return this.compareTo(t)>=0}static parse(t){if(t instanceof n)return new n(t.major(),t.minor());if("number"==typeof t)return(0,s.assert)(Math.floor(t)===t,"Version should not be a float number"),new n(t,0);if("string"==typeof t){const e=t.split(".");if(1===e.length){const i=parseInt(e[0],10);return(0,s.assert)(!isNaN(i),"Bad version string: "+t),new n(i,0)}if(2===e.length){const i=parseInt(e[0],10);(0,s.assert)(!isNaN(i),"Bad version string: "+t);const r=parseInt(e[1],10);return(0,s.assert)(!isNaN(r),"Bad version string: "+t),new n(i,r)}throw new Error("Bad version string (one dot expected): "+t)}throw new Error("Bad version: "+t)}}n.ZERO=new n(0,0)},730936:(t,e,i)=>{"use strict";i.d(e,{iterateAndPatchObjectsByMap:()=>f,patchPropertiesAsync:()=>c,processLegacy:()=>y});var s=i(650151),n=i(735566),r=i(136734),o=i(925049),a=i(345848),u=i(603774),l=i(111332),d=i(779893);const p=(0,n.getLogger)("Pine.ScriptLib");function c(t,e,i,s=null,o){return p.logNormal("patchPropertiesAsync"),new Promise(((u,c)=>{if(!e.TVScriptMetaInfoExprs)return void u(t);const y=e.TVScriptMetaInfoExprs.tree||"",h=e.TVScriptMetaInfoExprs.patchMap||{};(function(t,e){(0,a.trackEvent)("Pine","ScriptLib.evalMetaInfoExprs");const i=d.Deferred(),s={username:window.user&&window.user.username,source:t,inputs:JSON.stringify(e||{})};return(0,l._pineFacadeAjax)("POST","/eval_pine_ex/",s).done(((t,e)=>{t.error?i.reject((0,l._readableError)(t.error,e)):t.success?i.resolve(t.result):i.reject((0,l.safetyGetReason)(t))})).fail((t=>{(0,l._anyRequestAsyncFail)(i,t)})),i.promise()})(y,i).done((i=>{if(!i)return void u(t);if(s?.aborted)return;const a=t.childs().inputs.childs().text.value(),l=i.rootValues;f([t,e.defaults,e],h,((e,i,s)=>{const n=l[s],r=e[0],a=e[1],u=e[2];if(void 0===o||void 0!==o[s]&&o[s]!==n)if(a.hasOwnProperty(i)&&u?.hasOwnProperty(i)&&p.logError(`Inconsistent meta info structure: both defaults and meta have property ${i}`),a.hasOwnProperty(i)){
const e=r[i];t.childs()?.patchMetaInfoDefaults?.value()?(e.value()===a[i]&&e.setValue(n),a[i]=n):e.setValue(n)}else u[i]=n})),void 0!==o&&Object.keys(l).forEach((t=>{void 0!==o[t]&&(o[t]=l[t])}));const d=t.childs().inputs.childs().text.value();a&&!d&&(0,r.getPersistentLogger)()?.addPersistentLogEntry(`Detected invalid meta info evaluation expression result: IL code input value is empty, id: ${e.fullId}`,n.LOGLEVEL.ERROR,"PineMetaInfoValidation"),u(t)})).fail((t=>{c(t)}))}))}function f(t,e,i){const n=Object.keys(e);for(let r=0;r<n.length;r++){const o=n[r],a=e[o],u=o.split(".");"defaults"===u[0]&&u.splice(0,1),(0,s.assert)(u.length>1,"Unexpectedly short json path");let l=[...t];for(let t=0;t<u.length-1;++t){const e=u[t];l=l.map((t=>t?t[e]:null))}i(l,u[u.length-1],a)}}function y(t,e){(0,a.trackEvent)("Pine","ScriptLib.processLegacy");const i=(0,o.createDeferredPromise)(),s=window.user&&window.user.username,n="/process_legacy/"+encodeURIComponent(t)+"/?user_name="+encodeURIComponent(s),r=e?{source:e}:{};return(0,l._pineFacadeAjax)("POST",n,r).done((t=>{t.error?i.reject((0,l._readableError)(t.error)):t.success?((0,u.logPineMetaInfoIssues)("ScriptLib.processLegacy",t.result.metaInfo),i.resolve(t.result.metaInfo)):i.reject((0,l.safetyGetReason)(t))})).fail((t=>{(0,l._anyRequestAsyncFail)(i,t)})),i.promise}},301320:(t,e,i)=>{"use strict";i.d(e,{migrateMetaInfoAndPropState:()=>d});var s=i(650151),n=i(807958),r=i(536794);const o=["PennantCP@tv-basicstudies","WedgeCP@tv-basicstudies"],a=["DoubleTopCP@tv-basicstudies","BullishFlagCP@tv-basicstudies","HeadAndShouldersCP@tv-basicstudies","TripleTopCP@tv-basicstudies"];class u{targetMetaInfoVersion(){return 53}migrateMetaInfo(t){const e=t,i=t;if(i._metainfoVersion=53,void 0!==e.defaults&&void 0!==e.defaults.inputs&&(o.includes(e.id)||a.includes(e.id)&&Number(e.version)<156)){const t=e.defaults.inputs["Invert Pattern"];i.id=this._getNewIdStudies(e.id,t)}}migratePropState(t){}_getNewIdStudies(t,e){return t.startsWith("WedgeCP")?e?"WedgeFallingCP@tv-basicstudies":"WedgeRisingCP@tv-basicstudies":t.startsWith("PennantCP")?e?"PennantBearishCP@tv-basicstudies":"PennantBullishCP@tv-basicstudies":t.startsWith("DoubleTopCP")&&e?"DoubleBottomCP@tv-basicstudies":t.startsWith("BullishFlagCP")&&e?"BearishFlagCP@tv-basicstudies":t.startsWith("HeadAndShouldersCP")&&e?"HeadAndShouldersInverseCP@tv-basicstudies":t.startsWith("TripleTopCP")&&e?"TripleBottomCP@tv-basicstudies":t}}const l=[new class{targetMetaInfoVersion(){return 47}migrateMetaInfo(t){const e=t,i=t;if(i._metainfoVersion=47,!e.defaults||void 0===e.defaults.precision)return void(i.format={type:"inherit"});const s=e.defaults&&e.defaults.precision,n=(0,r.isNumber)(s)?s:parseInt(s);0===n?i.format={type:"volume"}:isFinite(n)?i.format={type:"price",precision:n}:i.format={type:"inherit"},delete e.defaults.precision}migratePropState(t){}},new class{targetMetaInfoVersion(){return 50}migrateMetaInfo(t){const e=t,i=t;if(i._metainfoVersion=50,void 0===e.defaults||void 0===e.defaults.ohlcPlots||void 0===e.ohlcPlots)return
;const n=e.ohlcPlots,r=e.defaults.ohlcPlots,o=(0,s.ensureDefined)((0,s.ensureDefined)(i.defaults).ohlcPlots);for(const t of Object.keys(r)){const e=r[t];if("ohlc_candles"===e.plottype){let i=!1;const s=n[t];void 0!==s&&(i=!!s.drawBorder,delete s.drawBorder),o[t]={borderColor:"#000000",drawBorder:i,...e}}}}migratePropState(t){}},new class{targetMetaInfoVersion(){return 53}migrateMetaInfo(t){const e=t,i=t;if(i._metainfoVersion=53,void 0!==e.defaults){if(void 0!==e.defaults.ohlcPlots&&void 0!==e.ohlcPlots){const t=Object.keys(e.ohlcPlots),n=e.defaults.ohlcPlots,r=(0,s.ensureDefined)((0,s.ensureDefined)(i.defaults).ohlcPlots);for(const e of t){const t=n[e];if(void 0===t||void 0===t.visible)continue;const i=t.visible?15:0;delete t.visible,r[e]={display:i,...t}}}if(void 0!==e.defaults.styles&&void 0!==e.plots){const t=e.plots.map((t=>t.id)),n=e.defaults.styles,r=(0,s.ensureDefined)((0,s.ensureDefined)(i.defaults).styles);for(const e of t){const t=n[e];if(void 0===t||void 0===t.visible)continue;const i=t.visible?15:0;delete t.visible,r[e]={display:i,...t}}}}}migratePropState(t){if(t.ohlcPlots)for(const e of Object.keys(t.ohlcPlots)){const i=(0,s.ensureDefined)(t.ohlcPlots[e]);void 0!==i.visible&&(i.display=i.visible?15:0,delete i.visible)}if(t.styles)for(const e of Object.keys(t.styles)){const i=(0,s.ensureDefined)(t.styles[e]);void 0!==i.visible&&(i.display=i.visible?15:0,delete i.visible)}}}];function d(t,e){const i=n.StudyMetaInfo.versionOf(t),r=t;void 0===r._serverMetaInfoVersion&&(r._serverMetaInfoVersion=i);const o=["PennantCP@tv-basicstudies","WedgeCP@tv-basicstudies"].includes(t.id);l.forEach((n=>{(i<0||i>=n.targetMetaInfoVersion())&&!o||(n.migrateMetaInfo(t),void 0!==e&&n.migratePropState(e),(0,s.assert)(t._metainfoVersion===n.targetMetaInfoVersion()))}))}l.push(new u),l.sort((function(t,e){return t.targetMetaInfoVersion()-e.targetMetaInfoVersion()}))},479483:(t,e,i)=>{"use strict";i.d(e,{ChartColorDependentStudyInputNames:()=>r,InputDisplayFlags:()=>s,RangeDependentStudyInputNames:()=>n,areStudyInputsEqual:()=>p,editableStudyInputs:()=>y,getInputValue:()=>l,isExtendedInput:()=>a,isExtendedInputBool:()=>g,isExtendedInputSource:()=>u,isStudyInputDependsOnChart:()=>v,isStudyInputDependsOnChartColors:()=>h,isStudyInputOptionsInfo:()=>d,isTimeOrPriceNotHiddenInput:()=>f,rangeDependentStudyInputsToTimeRange:()=>c});var s,n,r,o=i(182433);function a(t){return(0,o.default)(t)}function u(t){return"source"===t.t}function l(t){return a(t)?t.v:t}function d(t){return["text","integer","float","price","session","resolution"].includes(t.type)&&t.hasOwnProperty("options")}function p(t,e,i){for(const s of t)if(e[s.id]!==i[s.id])return!1;return!0}function c(t){return{from:Math.round(t.first_visible_bar_time/1e3),to:Math.round(t.last_visible_bar_time/1e3)}}function f(t){return("time"===t.type||"price"===t.type)&&!0!==t.isHidden}function y(t){const e=t.filter(f);if(0===e.length)return[];const i=new Map,s=[];e.forEach((t=>{const{group:e,inline:n}=t;if(void 0===n)return void s.push(t);const r=n+(e||"");if(i.has(r))i.get(r)?.push(t);else{
const e=[t];i.set(r,e),s.push(e)}}));const n=[];for(let t=0;t<s.length;t++){const e=s[t];Array.isArray(e)?2===e.length&&e[0].type!==e[1].type?n.push(e):n.push(...e):n.push(e)}return n}function h(t){return Object.values(r).map((t=>t)).includes(t.id)}function v(t){return!!h(t)||Object.values(n).map((t=>t)).includes(t.id)}function g(t){return(0,o.default)(t)&&"t"in t&&"bool"===t.t&&"v"in t&&"boolean"==typeof t.v}!function(t){t[t.None=0]="None",t[t.DataWindow=2]="DataWindow",t[t.StatusLine=8]="StatusLine",t[t.All=15]="All"}(s||(s={})),function(t){t.FirstBar="first_visible_bar_time",t.LastBar="last_visible_bar_time",t.Realtime="subscribeRealtime"}(n||(n={})),function(t){t.FgColor="__chart_fgcolor",t.BgColor="__chart_bgcolor"}(r||(r={}))},87347:(t,e,i)=>{"use strict";i.d(e,{emptyPineId:()=>h,isStudyDescriptor:()=>v,studyMetaInfoRepository:()=>S});var s=i(481251),n=i(444372),r=i(650151),o=i(807958),a=i(301320),u=i(886338),l=i(192809),d=i(884934),p=i(401843),c=i(735566),f=i(925049);const y=(0,c.getLogger)("Chart.Studies.StudyMetaInfoRepository",{color:"#606"}),h="";function v(t){return"object"==typeof t&&null!==t&&"type"in t&&("java"===t.type&&"studyId"in t||"pine"===t.type&&"pineId"in t)}class g{constructor(t){this._isReady=!1,this._studyVersioning=null,this._rawStudiesMetaInfo=[],this._rawStudiesMetaInfoDeferredPromise=null,this._javaStudiesMetaInfo=[],this._pineMetaInfoCache=[],this._compileErrors=new WeakMap,this._studiesMigrations=[],this._chartApi=t}async requestMetaInfo(){if(null===this._rawStudiesMetaInfoDeferredPromise){this._rawStudiesMetaInfoDeferredPromise=(0,f.createDeferredPromise)();const t=await this._chartApi.requestMetadata(),e=t.params[1].metainfo.slice();{const i=t.params[1].migrations.slice();this._processSiteMetaInfo(e,i)}this._studyVersioning=new l.StudyVersioning(this._javaStudiesMetaInfo,this._studiesMigrations),this._requestFinished(),this._rawStudiesMetaInfoDeferredPromise.resolve(this._rawStudiesMetaInfo)}return this._rawStudiesMetaInfoDeferredPromise.promise}async findById(t){this._isReady||await this.requestMetaInfo();const e=this._findStudyMetaInfo(t);if(null!==e){const t=this._compileErrors.get(e);return t?Promise.reject(t):Promise.resolve(e)}return"pine"===t.type?this._compilePine(t):Promise.reject(`unexpected study id=${t.studyId} with type=${t.type}`)}findByIdSync(t){return this._findStudyMetaInfo(t)}isReady(){return this._isReady}async findAllJavaStudies(){return this._isReady||await this.requestMetaInfo(),this._javaStudiesMetaInfo}studyVersioning(){return(0,r.ensureNotNull)(this._studyVersioning)}getInternalMetaInfoArray(){return this._javaStudiesMetaInfo}addPineMetaInfo(t,e){const i=m(this._pineMetaInfoCache,t);return e&&(!Array.isArray(e)||e.length>0)&&(e=Array.isArray(e)?new p.PineCompileFailErrorImpl({warnings:[],errors:e},t):e,this._compileErrors.set(i,e)),i}async getLatestMetaInfoForPineStudy(t,e){const i=await(0,d.requestUserScripts)();let s;if(i){const n=i.find((e=>e.scriptIdPart===t));if(n){const t=u.Version.parse(e),i=u.Version.parse(n.version);t.isLess(i)&&(s=n.version)}}
if(void 0!==s){const e={type:"pine",pineId:t,pineVersion:s};return this.findById(e)}return null}_processMigrations(t){this._studiesMigrations=[];for(let e=0;t&&e<t.length;e++)this._studiesMigrations.push(t[e])}_processSiteMetaInfo(t,e){for(const e of t)l.StudyVersioning.verifyInputsMaxValue(e),I(e);this._rawStudiesMetaInfo=t,this._processMigrations(e);for(const t of this._rawStudiesMetaInfo)m(this._javaStudiesMetaInfo,t);o.StudyMetaInfo.overrideDefaults(this._javaStudiesMetaInfo)}_processLibraryMetaInfo(t){}_requestFinished(){this._isReady=!0}_findStudyMetaInfo(t){return"java"===t.type?((0,r.assert)(0!==this._javaStudiesMetaInfo.length,"Java studies metainfo should be define here"),this._javaStudiesMetaInfo.find((e=>e.id===t.studyId))||null):this._pineMetaInfoCache.find((e=>e.scriptIdPart===t.pineId&&(void 0===t.pineVersion||(0,r.ensureDefined)(e.pine).version===t.pineVersion)))||null}_compilePine(t){y.logNormal(`Compiling ${t.pineId} script`);const e=(0,d.translateScriptAsync2)(t.pineId,t.pineVersion||"last").then((({metaInfo:e,compileErrors:i})=>(y.logNormal(`Compiling ${t.pineId} is successful`),this.addPineMetaInfo((0,r.ensureDefined)(e),i.errors))));return e.catch((e=>{e instanceof p.PineCompileFailErrorImpl&&this.addPineMetaInfo(e.metaInfo,e),y.logNormal(`Compiling ${t.pineId} is failed`)})),e}}function I(t){t.description_localized=n.t(t.description,{context:"study"},i(783477))}function m(t,e){const i=new o.StudyMetaInfo(e).state();(0,a.migrateMetaInfoAndPropState)(i);const s=new o.StudyMetaInfo(i);let n=!0;const r=t.findIndex((t=>t.id===s.id));if(-1===r)t.push(s);else{const e=t[r],i=void 0!==e.pine?u.Version.parse(e.pine.version):null,o=void 0!==s.pine?u.Version.parse(s.pine.version):null;null===o||null===i||o.isGreaterOrEqual(i)?(e.removeDefaults(),t[r]=s):n=!1}return n&&s.createDefaults(),s}const S=(0,s.default)((()=>new g(window.ChartApiInstance)))},498889:(t,e,i)=>{"use strict";i.d(e,{applyOverridesToStudy:()=>p,applyOverridesToStudyDefaults:()=>c});var s=i(650151),n=i(974145),r=i(735566);const o={line:n.LineStudyPlotStyle.Line,histogram:n.LineStudyPlotStyle.Histogram,cross:n.LineStudyPlotStyle.Cross,area:n.LineStudyPlotStyle.Area,columns:n.LineStudyPlotStyle.Columns,circles:n.LineStudyPlotStyle.Circles,line_with_breaks:n.LineStudyPlotStyle.LineWithBreaks,area_with_breaks:n.LineStudyPlotStyle.AreaWithBreaks,step_line:n.LineStudyPlotStyle.StepLine,step_line_with_breaks:n.LineStudyPlotStyle.StepLineWithBreaks,step_line_with_diamonds:n.LineStudyPlotStyle.StepLineWithDiamonds},a=(0,r.getLogger)("Chart.Model.StudyPropertiesOverrider");var u,l;function d(t,e,i,s){const n=i.split(".");if(0===n.length||0===n[0].length)return;const r=function(t){const e=t.split(":");return{name:e[0],type:2===e.length?e[1]:null}}(n[0]),o=r.name,d=r.type,p=null!==d,c=!p||"band"===d,f=!p||"area"===d,y=!p||"input"===d,h=!p||"plot"===d?l.getPlotIdByTitle(t,o):null,v=c?l.getBandIndexByName(t,o):null,g=f?l.getFilledAreaIdByTitle(t,o):null,I=y?l.getInputByName(t,o):null,m=e.hasOwnProperty(o)
;if((null!==h?1:0)+(null!==v?1:0)+(null!==g?1:0)+(null!==I?1:0)+(m?1:0)>1)return void a.logWarn(`Study '${t.description}' has ambiguous identifier '${o}'`);const S=n[1];if(null!==h){if(1===n.length)return void a.logWarn(`Path of sub-property of '${o}' plot for study '${t.description}' must be not empty`);const i=n.slice(1);u.applyPlotProperty(t,e,h,i,s)}else if(null!==I)u.applyInputValue(e,I,s);else if(null!==v){if(void 0===S)return void a.logWarn(`Property name of '${o}' band for study '${t.description}' must be set`);u.applyBandProperty(e,v,S,s)}else if(null!==g){if(void 0===S)return void a.logWarn(`Property name of '${o}' area for study '${t.description}' must be set`);u.applyFilledAreaProperty(e,g,S,s)}else m?u.setRootProperty(e,n,s):a.logWarn(`Study '${t.description}' has no plot or input '${o}'`)}function p(t,e){const i=t.properties(),s=i.state();for(const i in e)e.hasOwnProperty(i)&&d(t.metaInfo(),s,i,e[i]);i.mergeAndFire(s)}function c(t,e,i){for(const s in t){if(!t.hasOwnProperty(s))continue;const n=s.indexOf(".");if(-1===n)continue;const r=s.substring(0,n),o=l.getMetaInfoByDescription(e,r);if(null===o){a.logWarn(`There is no such study ${r}`);continue}const u=i(o);null!==u?d(o,u,s.substring(n+1),t[s]):a.logWarn(`Cannot apply overrides for study ${r}`)}}!function(t){t.applyPlotProperty=function(t,e,i,r,u){if(void 0===e.styles)return void a.logWarn("Study does not have styles");const l=r[0];if("color"===l){const o=function(t,e,i){if(void 0===t.plots)return null;for(const s of t.plots){if(!(0,n.isPaletteColorerPlot)(s)||void 0===e.palettes)continue;const t=e.palettes[s.palette];if(s.target===i&&void 0!==t)return t}return null}(t,e,i);return void function(t,e,i,n,r){void 0!==t.styles?null===e&&!isNaN(n)&&n>0?a.logWarn(`Study plot does not have color #${n}`):((0===n||isNaN(n))&&((0,s.ensureDefined)(t.styles[i]).color=String(r),n=0),null!==e&&((0,s.ensureDefined)(e.colors?.[n]).color=String(r))):a.logWarn("Study does not have styles")}(e,o,i,r.length>1?parseInt(r[1]):NaN,u)}const d=e.styles[i];if(void 0!==d&&d.hasOwnProperty(l)){if("plottype"===l){const t=o[String(u)];if(void 0===t)return void a.logWarn(`Unsupported plot type for plot: ${u}`);u=t}d[l]=u}else a.logWarn(`Study plot does not have property '${l}'`)},t.applyBandProperty=function(t,e,i,s){if(void 0===t.bands)return void a.logWarn("Study does not have bands");const n=t.bands[e];if(void 0!==n&&n.hasOwnProperty(i)){if("plottype"===i){const t=o[String(s)];if(void 0===t)return void a.logWarn(`Unsupported plot type for band: ${s}`);s=t}n[i]=s}else a.logWarn(`Study band does not have property '${i}'`)},t.applyFilledAreaProperty=function(t,e,i,s){if(void 0===t.filledAreasStyle)return void a.logWarn("Study does not have areas");const n=t.filledAreasStyle[e];void 0!==n&&n.hasOwnProperty(i)?n[i]=s:a.logWarn(`Study area does not have property '${i}'`)},t.applyInputValue=function(t,e,i){void 0!==t.inputs&&t.inputs.hasOwnProperty(e)?t.inputs[e]=i:a.logWarn(`Study does not have input '${e}'`)},t.setRootProperty=function(t,e,i){if(0===e.length)return;let s=t
;for(const t of e.slice(0,-1)){if(null==s||!s.hasOwnProperty(t))break;s=s[t]}const n=e[e.length-1];null!=s&&s.hasOwnProperty(n)?s[n]=i:a.logWarn(`Study does not have property ${e.join(".")}`)}}(u||(u={})),function(t){t.getInputByName=function(t,e){if(void 0===t.inputs)return null;e=e.toLowerCase();for(const i of t.inputs)if(i.name.toLowerCase()===e)return i.id;return null},t.getPlotIdByTitle=function(t,e){if(void 0===t.styles)return null;e=e.toLowerCase();for(const i in t.styles){const s=t.styles[i];if((void 0!==s&&void 0!==s.title?s.title:i).toLowerCase()===e)return i}return null},t.getFilledAreaIdByTitle=function(t,e){if(void 0===t.filledAreas)return null;e=e.toLowerCase();for(const i of t.filledAreas)if(i.title.toLowerCase()===e)return i.id;return null},t.getBandIndexByName=function(t,e){if(void 0===t.bands)return null;e=e.toLowerCase();for(let i=0;i<t.bands.length;++i)if(t.bands[i].name.toLowerCase()===e)return i;return null},t.getMetaInfoByDescription=function(t,e){e=e.toLowerCase();for(const i of t)if(i.description.toLowerCase()===e||i.shortDescription.toLowerCase()===e)return i;return null}}(l||(l={}))},736524:(t,e,i)=>{"use strict";const{clone:s}=i(536794);var n=i(886338).Version,r=i(735566).getLogger("Chart.StudyMigration");function o(t){this._studyId=t,this._maxToVers=n.ZERO,this._maxFromVers=n.ZERO,this._migrs=[]}o.prototype.addMigration=function(t,e,i){var s=n.parse(t),r=n.parse(e);s.isGreater(this._maxFromVers)&&(this._maxFromVers=s),r.isGreater(this._maxToVers)&&(this._maxToVers=r),this._migrs.push({fromVers:s,toVers:r,rules:i})},o.prototype.updateInputs=function(t,e,i){if(!i)return i;for(var n=s(i),o=t;o.isLess(e);){var a=this._findMigration(o);if(null==a)break;if(r.logNormal("Migrating study inputs from "+a.fromVers+" to "+a.toVers+" version, studyId: "+this._studyId+", migration: "+JSON.stringify(a)+", inputs: "+JSON.stringify(i)),n=this._applyMigration(n,a),!o.isLess(a.toVers))throw new Error("Problems in study migration process... Possible infinite cycle has been detected and stopped.");o=a.toVers}return o>t&&r.logNormal("Study inputs migration is done, studyId: "+this._studyId+", inputs: "+JSON.stringify(n)),n},o.prototype._findMigration=function(t){for(var e=-1,i=this._maxFromVers,s=0;s<this._migrs.length;s++){var n=this._migrs[s];n.fromVers.isLess(t)||n.fromVers.isLessOrEqual(i)&&(i=n.fromVers,e=s)}return e<0?null:this._migrs[e]},o.prototype._applyMigration=function(t,e){for(var i=t,s=0;s<e.rules.length;s++){var n=e.rules[s];i=this._getApplyRuleFun(n.type)(i,n)}return i},o.prototype._getApplyRuleFun=function(t){if("inputRemoved"===t)return o._applyInputRemovedRule;if("inputChangedType"===t)return o._applyInputChangedTypeRule;if("inputChangedMinMax"===t)return o._applyInputChangedMinMaxRule;if("inputChangedOptions"===t)return o._applyInputChangedOptionsRule;throw new Error("Unknown migration rule type: "+t)},o._applyInputRemovedRule=function(t,e){if(!(e.inputId in t))return t;if("removeVal"!==e.action)throw new Error("Unexpected rule.action="+e.action+" in rule.type="+e.type);var i=t[e.inputId]
;return delete t[e.inputId],r.logNormal("Input "+e.inputId+"="+i+" removed"),t},o._applyInputChangedTypeRule=function(t,e){var i=t[e.inputId];if("resetToDefVal"===e.action)return t[e.inputId]=e.defVal,r.logNormal("Input "+e.inputId+"="+i+" reset to default value "+e.defVal),t;if("convertVal"===e.action){if(null==i)return t;if("float"===e.inputTypeFrom&&"integer"===e.inputType)return t[e.inputId]=Math.round(t[e.inputId]),r.logNormal("Input "+e.inputId+"="+i+" converted to value "+t[e.inputId]),t;if("integer"===e.inputTypeFrom&&"float"===e.inputType)return t;if("text"===e.inputTypeFrom&&"source"===e.inputType)return o._isValidSource(i,e.options)||(t[e.inputId]=e.defVal),t;throw new Error("Cannot convertVal from "+e.inputTypeFrom+" to "+e.inputType)}throw new Error("Unknown action "+e.action+" for rule with type "+e.type)},o._isValidSource=function(t,e){return t.indexOf("$")>=0||e.indexOf(t)>=0},o._applyInputChangedMinMaxRule=function(t,e){if("adjustValIfNeeded"!==e.action)throw new Error("Unknown action "+e.action+" for rule with type "+e.type);var i=t[e.inputId];return i<e.minVal?t[e.inputId]=e.minVal:i>e.maxVal&&(t[e.inputId]=e.maxVal),r.logNormal("Input "+e.inputId+"="+i+" adjusted to value "+t[e.inputId]),t},o._applyInputChangedOptionsRule=function(t,e){if(!(["text"].indexOf(e.inputType)>=0&&"resetToDefValIfNeeded"===e.action))throw new Error("Unexpected rule.inputType="+e.inputType+" in rule.action="+e.action);var i=t[e.inputId];return e.options.indexOf(i)<0&&(t[e.inputId]=e.defVal,r.logNormal("Input "+e.inputId+"="+i+" reset to default value "+e.defVal)),t},t.exports=o},192809:(t,e,i)=>{"use strict";i.d(e,{StudyVersioning:()=>m});var s=i(998034),n=i(650151),r=i(807958),o=i(736524),a=i.n(o),u=i(735566),l=i(886338),d=i(301320),p=i(884934),c=i(444372);var f=i(730936),y=i(971417),h=i(66974),v=i(536794);const g=(0,u.getLogger)("Chart.Study.Versioning"),I=1e12;class m{constructor(t,e){if(this._migrations={},!t)throw new Error("No studies metainfo");if(this._studiesMetainfo=t,!e)throw new Error("No studies migrations");this._studiesMigrations=e;for(let t=0;t<this._studiesMigrations.length;t++){const e=this._studiesMigrations[t],i=e.versFrom,s=e.versTo;for(let t=0;t<e.studyMigrations.length;t++){const n=e.studyMigrations[t],r=n.studyId;if(0===n.rules.length){g.logError("Study Migration should have at least one convertion rule");continue}const o=r in this._migrations?this._migrations[r]:new(a())(r);o.addMigration(i,s,n.rules),this._migrations[r]=o}}this._clientMigrations=[(t,e)=>{if(0===this._studiesMetainfo.length||!t.isTVScript||t.version>=22)return e;const i={};let s=0,n=0,r=e[n];for(;void 0!==r;){const t=e[r.id];r.isFake&&(r.id="in_"+s++),i[n]=r,i[r.id]=t,n++,r=e[n]}return i}]}updateMetaInfoAsync(t,e){const i=r.StudyMetaInfo.versionOf(t);if(t.isTVScript&&!t.pine&&i<43){(0,n.assert)((0,v.isExistent)(t.scriptIdPart),"scriptIdPart is missing, study "+JSON.stringify(t));const i=t.scriptIdPart;return{sync:!1,result:new Promise(((s,n)=>{(0,f.processLegacy)(i,t.TVScriptSourceCode).then((i=>{t.removeDefaults()
;const n=new r.StudyMetaInfo(i);e&&n.createDefaults();const o=n.state();(0,d.migrateMetaInfoAndPropState)(o),s(new r.StudyMetaInfo(o))})).catch((t=>{n(t)}))}))}}if(t.isTVScript&&t.pine){if((t._serverMetaInfoVersion||i)<52){return{sync:!1,result:(0,p.translateScriptAsync2)(t.scriptIdPart,t.pine.version).then((i=>{t.removeDefaults();const s=new r.StudyMetaInfo(i.metaInfo);e&&s.createDefaults();const n=s.state();return(0,d.migrateMetaInfoAndPropState)(n),new r.StudyMetaInfo(n)}))}}return e&&t.createDefaults(),{sync:!0,result:t}}{let e=null;const i=this._studiesMetainfo;for(let s=0;s<i.length;s++)if(i[s].id===t.id){e=i[s];break}return{sync:!0,result:e?new r.StudyMetaInfo(e.state()):null}}}updateStudyState(t,e,i){if(null==t||null==e||null==i)return t;t=(0,v.clone)(t),this.updateStudyInputsIfNeeded(t,e.version,i);for(const i of this._clientMigrations){const s=i.call(this,e,t.inputs);Object.keys(s).length===Object.keys(t.inputs).length?t.inputs=s:g.logWarn("StudyVersioning._clientMigrations application returned bad result. Skipping it...")}const s=r.StudyMetaInfo.versionOf(e);if(e.isTVScript&&e.TVScriptSourceCode&&s>=12&&s<=26){const s={};for(let t=0;t<e.plots.length;++t){const n=e.plots[t],r=i.plots[t];s[n.id]=r.id}const n=Object.keys(t.styles);for(let e=0;e<n.length;++e){const i=n[e],r=t.styles[i];delete t.styles[i];const o=s[i];t.styles[o]=r}const r=Object.keys(t.plots);for(let e=0;e<r.length;++e){const i=r[e],n=t.plots[i].id;t.plots[i].id=s[n]}}return t}updateStudyInputsIfNeeded(t,e,i){if(!(i.isTVScript||!!i.pine)&&e!==i.version){const s=i&&i.defaults.inputs;t.inputs=this.updateStudyInputs(i.id,e,i.version,t.inputs,s)}}updateStudyInputs(t,e,i,s,n){let r=(0,v.clone)(s);if(t in this._migrations){const s=l.Version.parse(e);let n;if("last"===i){const e=this.lastVersionOfStudy(t);n=l.Version.parse(e)}else n=l.Version.parse(i);r=this._migrations[t].updateInputs(s,n,r)}if(null==n)return r;for(const t in n)t in r||(r[t]=n[t]);for(const i in r)if(!(i in n)){const s=r[i];g.logWarn(`Extra input detected, studyId='${t}', versionFrom='${e}', inputId='${i}', inputValue='${s}', removing it and continue...`),delete r[i]}return r}lastVersionOfStudy(t){return(0,n.ensureDefined)(this._studiesMetainfo.find((e=>e.id===t))).version}updateMetaInfo(t){if(!t)return t;(0,n.assert)(t instanceof r.StudyMetaInfo),(0,n.assert)(!t.isTVScript,"This method should update only built-in java indicators metaInfo. For Pine indicators use updateMetaInfoAsync");const e=this._studiesMetainfo.find((e=>t.id===e.id));return e?new r.StudyMetaInfo(e.state()):null}static patchPointsBasedStudyState(t){return this._fixInputsMaxValue(t.state,t.metaInfo),"LineToolRegressionTrend"===t.type&&(t=function(t){const e={palettes:{},inputs:[{defval:2,id:"upper diviation",max:500,min:-500,name:c.t(null,void 0,i(591900)),type:"integer"},{defval:-2,id:"lower diviation",max:500,min:-500,name:c.t(null,void 0,i(831736)),type:"integer"},{defval:!0,id:"use upper diviation",name:c.t(null,void 0,i(784451)),type:"bool"},{defval:!0,id:"use lower diviation",name:c.t(null,void 0,i(449299)),
type:"bool"},{defval:0,id:"first bar time",max:253370764800,min:0,name:c.t(null,void 0,i(780509)),type:"time"},{defval:0,id:"last bar time",max:253370764800,min:0,name:c.t(null,void 0,i(59933)),type:"time"},{defval:"close",id:"source",name:c.t(null,void 0,i(997751)),options:["open","high","low","close","hl2","hlc3","ohlc4"],type:"text"}],plots:[],graphics:{},defaults:{inputs:{"first bar time":0,"last bar time":0,"lower diviation":-2,source:"close","upper diviation":2,"use lower diviation":!0,"use upper diviation":!0}},_metainfoVersion:6,description:"Regression Trend",id:"RegressionTrend@tv-basicstudies",is_price_study:!0,shortDescription:"Reg Trend",shortId:"RegressionTrend",version:"2",fullId:"RegressionTrend@tv-basicstudies-2",name:"RegressionTrend@tv-basicstudies"};return t.metaInfo||(t.metaInfo=e),t}(t)),t}static patchStudyData(t,e,i,s){if(!(0,h.isProd)())return{data:e,nsData:i,indexes:s??void 0};const n=(0,v.clone)(e),o=(0,v.clone)(i),a=(0,v.clone)(s);"VbPVisible@tv-volumebyprice"===t.id&&t.version&&+t.version<=4&&this._patchOldVolumeProfiles(0,n?.graphics),"VbPSessions@tv-volumebyprice"===t.id&&t.version&&+t.version<=4&&this._patchOldVolumeProfiles(0,n?.graphics);const u=r.StudyMetaInfo.versionOf(t);if(n&&t.isTVScript&&t.TVScriptSourceCode&&u>=12&&u<=26){const t=n.columns,e=[];n.columns=e;for(let i=0;i<t.length;++i){const t="plot_"+i;e.push(t)}}return{data:n,nsData:o,indexes:a??void 0}}static patchPointsBasedStudyData(t,e){if(!(0,h.isProd)())return e;if(!t||!e)return e;const i=(0,v.clone)(e);return"VbPFixed@tv-volumebyprice"===t.id&&t.version&&+t.version<=4&&this._patchOldVolumeProfiles(0,i),i}static patchPropsStateAndMetaInfo(t,e,i){let n=e.state();"Script$BOOKER"!==e.productId||n.alerts||delete t.alerts,this._fixInputsOrder(t,n),this._fixInputsMaxValue(t,n);const o=this.splitInputs(t.inputs);t.inputs=o.obj;const a=r.StudyMetaInfo.versionOf(e);a<42&&n.isChildStudy&&(t.isChildStudy=n.isChildStudy);if(e.isTVScript&&e.version<60&&("Script$TV_EARNINGS@tv-scripting"!==e.id&&"Script$TV_DIVIDENDS@tv-scripting"!==e.id&&"Script$TV_SPLITS@tv-scripting"!==e.id||delete n.TVScriptSourceCode),"Volume"!==e.id&&"Volume@tv-basicstudies"!==e.id||0!==e.inputs.length||(n.inputs=[{id:"length",type:"integer",defval:20,min:1,max:1e3}],n.plots.push({id:"vol_ma",type:"line"})),"Volume@tv-basicstudies"===e.id&&e.version&&e.version<=46&&void 0===t.styles.vol.transparency&&(t.styles.vol.transparency=t.transparency||87),"PivotPointsStandard@tv-basicstudies"===e.id&&(0===n.inputs.length?(t.inputs={kind:"Traditional",showHistoricalPivots:!0},n.inputs=[{defval:"Traditional",id:"kind",type:"text",options:["Traditional","Fibonacci","Woodie","Classic","DeMark","Camarilla"]},{id:"showHistoricalPivots",type:"bool",defval:!0}]):1===n.inputs.length&&(t.inputs={kind:"Traditional"},n.inputs=[{defval:"Traditional",id:"kind",type:"text",options:["Traditional","Fibonacci","Woodie","Classic","DeMark","Camarilla"]},{id:"showHistoricalPivots",type:"bool",defval:!0}]),void 0===t._hardCodedDefaultsVersion)){t._hardCodedDefaultsVersion=1;const e=t.color
;delete t.color,t.levelsStyle={colors:{P:e,"S1/R1":e,"S2/R2":e,"S3/R3":e,"S4/R4":e,"S5/R5":e}}}"CMF"===e.shortId&&2===n.inputs.length&&(t.inputs={length:t.inputs["length fast"]},n.inputs=n.inputs.splice(0,1),n.inputs[0].id="length"),n.defaults&&void 0===n.defaults.precision&&a<46&&(-1!==["Volume@tv-basicstudies","VbPVisible@tv-volumebyprice","VbPSessions@tv-volumebyprice"].indexOf(e.id)?n.defaults.precision=0:n.defaults.precision=4);let u=e.id;if(e.version<60){const t=["TV_DIVIDENDS","TV_SPLITS","TV_EARNINGS"],i=6;for(let s=0;s<t.length;s++)e.id.startsWith("Script$"+t[s]+"@tv-scripting")&&(n.fullId="ESD"+n.fullId.substring(i),n.id="ESD"+n.id.substring(i),n.name&&(n.name="ESD"+n.name.substring(i)),n.shortId="ESD"+n.shortId.substring(i),n.productId="ESD"+n.productId.substring(i),u="ESD"+e.id.substring(i))}const l={"ESD$TV_EARNINGS@tv-scripting":{fullId:"Earnings@tv-basicstudies-129!",id:"Earnings@tv-basicstudies",name:"Earnings@tv-basicstudies",shortId:"Earnings",productId:"tv-basicstudies"},"ESD$TV_SPLITS@tv-scripting":{fullId:"Splits@tv-basicstudies-129!",id:"Splits@tv-basicstudies",name:"Splits@tv-basicstudies",shortId:"Splits",productId:"tv-basicstudies"},"ESD$TV_DIVIDENDS@tv-scripting":{fullId:"Dividends@tv-basicstudies-129!",id:"Dividends@tv-basicstudies",name:"Dividends@tv-basicstudies",shortId:"Dividends",productId:"tv-basicstudies"}};if(u in l&&Object.assign(n,l[u]),a<43){const i={"StrategyScript$STD;Consecutive%1Ups/Downs%1Strategy":{pineId:"STD;Consecutive%1Ups%1Downs%1Strategy",className:"StrategyScript"},Script$EDGR_NET_INCOME_FROM_CONTINUING_OPERATIONS_APPLICABLE_TO_COMMON_V2:{pineId:"Script$EDGR_NET_INCOME_FROM_CONTINUING_OPS_APPLICABLE_TO_COMMON_V2",className:"Script"}};if(e.shortId in i){const r=i[e.shortId].className+"$"+i[e.shortId].pineId,o={scriptIdPart:i[e.shortId].pineId,fullId:n.fullId.replace(n.shortId,r),id:n.id.replace(n.shortId,r),name:n.name?.replace(n.shortId,r),shortId:r};(0,s.default)(n,o),(0,s.default)(t,o)}const r=(0,y.extractPineId)(e.fullId),o=r&&r.match(/^(USER)(_\d+)(;)(.*)$/);if(o){const e=o[0],i=o[1]+o[3]+o[2]+o[4],r={scriptIdPart:i,fullId:n.fullId.replace(e,i),id:n.id.replace(e,i),name:n.name?.replace(e,i),shortId:n.shortId.replace(e,i)};(0,s.default)(n,r),(0,s.default)(t,r)}}if("MA"===e.id){const e={id:"MAExp",properties:[{id:"is_price_study",type:"bool",value:"true"}],inputs:[{id:"length",type:"integer",defval:20,min:1,max:500},{id:"source",type:"text",defval:"close",options:["open","high","low","close"]}],plots:[{id:"MovAvgExp",type:"line"}],palettes:{}},i={id:"MASimple",properties:[{id:"is_price_study",type:"bool",value:"true"}],inputs:[{id:"length",type:"integer",defval:20,min:1,max:500},{id:"source",type:"text",defval:"close",options:["open","high","low","close"]}],plots:[{id:"MovAvgSimple",type:"line"}],palettes:{}},s={id:"MAVolumeWeighted",properties:[{id:"is_price_study",type:"bool",value:"true"}],inputs:[{id:"length",type:"integer",defval:20,min:1,max:500},{id:"source",type:"text",defval:"close",options:["open","high","low","close"]}],plots:[{id:"MovAvgVolumeWeighted",
type:"line"}],palettes:{}},r={id:"MAWeighted",properties:[{id:"is_price_study",type:"bool",value:"true"}],inputs:[{id:"length",type:"integer",defval:20,min:1,max:500},{id:"source",type:"text",defval:"close",options:["open","high","low","close"]}],plots:[{id:"MovAvgWeighted",type:"line"}],palettes:{}};switch(t.inputs.type){case"exp":n=e;break;case"simple":n=i;break;case"weighted":n=r;break;case"volume weighted":n=s}t.styles[n.plots[0].id]=t.styles.MovAvg,delete t.styles.MovAvg,delete t.inputs.type}return i.oldShowStudyLastValueProperty&&(t.oldShowLastValue=t.showLastValue),delete t.showLastValue,delete t.showStudyArguments,(0,d.migrateMetaInfoAndPropState)(n,t),{propsState:t,metaInfo:n}}static splitInputs(t){const e={},i={};for(const[s,n]of Object.entries(t))(0,v.isNumber)(parseInt(s,10))?e[s]=n:i[s]=n;return{arr:e,obj:i}}static verifyInputsMaxValue(t){if(t.inputs)for(const e of t.inputs)"integer"===e.type&&e.max&&e.max>I&&g.logWarn("Bad integer input max value in metaInfo id="+t.id+" title="+t.description)}static mergeInputsObjPart(t,e){const i=this.splitInputs(e);(0,s.default)(t,i.obj)}static _fixInputsOrder(t,e){const i=this._getOrderedInputIds(e),n=this.splitInputs(t.inputs),r=n.arr,o=n.obj,a=(0,s.default)({},o);for(let t=0;t<i.length;++t){const e=i[t],s=this._findInputKeyById(r,e);null!==s&&(a[t]=r[s])}t.inputs=a}static _fixInputsMaxValue(t,e){if((0,v.isAbsent)(e))return;const i=I;if(e.inputs)for(const t of e.inputs)"integer"===t.type&&t.max&&t.max>i&&(t.max=i);if(!t||!t.inputs)return;const n=this.splitInputs(t.inputs),r=n.arr;for(const[,t]of Object.entries(r))"integer"===t.type&&t.max&&t.max>i&&(t.max=i);t.inputs=(0,s.default)(n.obj,n.arr)}static _findInputKeyById(t,e){let i=null;for(const s in t)if((0,v.isNumber)(parseInt(s,10))&&t[s].id===e){i=s;break}return i}static _getOrderedInputIds(t){const e=[];for(const i of t.inputs)e.push(i.id);return e}static _patchOldVolumeProfiles(t,e){if(!e?.hhists)return;const i=e.hhists[t].data,s=[];for(const[,t]of Object.entries(i))s.push(t);e.hhists[0].data=s}}},807958:(t,e,i)=>{"use strict";i.r(e),i.d(e,{StudyMetaInfo:()=>T,getStudyIdWithVersion:()=>P,replayStrategyStudyId:()=>b});var s=i(283873),n=i(154834),r=i(536794),o=i(650151),a=i(735566),u=i(136734),l=i(974145),d=i(479483),p=i(85858),c=i(498889),f=i(646244),y=i(240448);const h=(0,a.getLogger)("Chart.Study.MetaInfo"),v=new Set(["CorrelationCoefficient@tv-basicstudies","Correlation - Log@tv-basicstudies-1"]),g=new Set([]),I=new Set(["line","shapes","chars","arrows","alertcondition"]),m=new Map([["AnchoredVWAP@tv-basicstudies","linetoolanchoredvwap"],["RegressionTrend@tv-basicstudies","linetoolregressiontrend"],["VbPAnchored@tv-basicstudies","linetoolanchoredvp"]]),S=/^([^\$]+)\$\d+$/,_=["bool","color","time","text_area"];function P(t){return T.cutDollarHash(t.id)+"-"+t.version}const b="ReplayStrategy@tv-scripting";class T{constructor(t,e=!1){(0,r.merge)(this,{palettes:{},inputs:[],plots:[],graphics:{},defaults:{}}),(0,r.merge)(this,t);const i=t.fullId||t.id;(0,r.merge)(this,T.parseIdString(i)),
this._updateInputDisplayDefaults(),this.useVersionFromMetaInfo=e}defaultInputs(){return this.inputs.map((t=>t.defval)).filter(r.isExistent)}state(){const t={};for(const[e,i]of Object.entries(this))"useVersionFromMetaInfo"!==e&&this.hasOwnProperty(e)&&(t[e]=(0,n.default)(i),"id"===e&&(t[e]+="-"+this.version));return t}symbolInputId(){return this.inputs.find((t=>"symbol"===t.type))?.id||null}createDefaults(){if(this.defaults){const t=(0,r.clone)(this.defaults);t.precision="default";const e=T.getStudyPropertyRootName(this);(0,p.createDefaults)(e,t)}}removeDefaults(){(0,p.removeDefaults)(T.getStudyPropertyRootName(this))}isPlotForceOverlay(t){const e=this.styles?.[t],i=this.plots.find((e=>e.id===t));return!!e?.forceOverlay||i&&(0,l.isOhlcPlot)(i)&&this.ohlcPlots?.[i.target]?.forceOverlay||!!this.ohlcPlots?.[t]?.forceOverlay}hasForceOverlayPlots(){return this.plots.some((t=>this.isPlotForceOverlay(t.id)))||Object.values(this.ohlcPlots??{}).some((t=>!!t?.forceOverlay))}static getSourceIdsByInputs(t,e){if(!Array.isArray(t)||!e)return[];const i=[];for(const n of t)if(T.isSourceInput(n)&&(0,s.default)(e[n.id])){const t=e[n.id];t.includes("$")&&i.push(t.split("$")[0])}return i}static isSourceInput(t){return Boolean(t.id&&(("source"===t.id||"src"===t.id)&&("text"===t.type||"source"===t.type)||"source"===t.type))}static getSourceInputIds(t){const e=[];for(const i of t.inputs)T.isSourceInput(i)&&e.push(i.id);return e}static setChildStudyMetaInfoPropertiesSourceId(t,e,i){for(const s of t.inputs){if(!T.isSourceInput(s))continue;const t=i.childs().inputs&&i.childs().inputs.childs()[s.id];if(t){const i=t.value(),s=S.exec(i);if(2===s?.length){if("{pid}"===s[1]){const s=i.replace(/^[^\$]+/,e);t.setValue(s)}}}}}static patchSoSInputs(t,e){const i=t=>{const i=S.exec(t);if(2===i?.length){const s=i[1],n=`${(0,o.ensureNotNull)(e(s))}`;return t.replace(/^[^\$]+/,n)}return t};for(const e in t)if(/in_[\d+]/.test(e)||"source"===e){const n=t[e];(0,s.default)(n)?t[e]=i(n):(0,d.isExtendedInput)(n)&&(0,d.isExtendedInputSource)(n)&&(n.v=i(n.v))}}static canBeChild(t){if((0,s.default)(t))return!0;if(!t)return!1;if(t.extra&&!T.isAllowedSourceInputsCount(t.extra.sourceInputsCount)||!0===t.canNotBeChild||!1===t.canBeChild||v.has(t.id))return!1;let e=0;for(const i of t.inputs)T.isSourceInput(i)&&(e+=1);return T.isAllowedSourceInputsCount(e)}static isAllowedSourceInputsCount(t){return t>0||1===t}static canHaveChildren(t){if(t){if(t.isTVScriptStrategy||t.TVScriptSourceCode&&(0,y.isStrategy)(t.TVScriptSourceCode))return!1;if(t.id&&!g.has(t.id)&&Array.isArray(t.plots))for(const e of t.plots)if(I.has(e.type))return!0}return!1}static getChildSourceInputTitles(t,e,i){const s={};if(e.plots&&e.plots.length&&t.options&&t.options.length)for(const n of t.options){const t=n?+n.split("$")[1]:NaN,r=isFinite(t)&&e.plots[t];r&&I.has(r.type)&&(s[n]=e.styles&&e.styles[r.id]&&e.styles[r.id]?.title||r.id,i&&(s[n]=i+": "+s[n]))}return s}static canPlotBeSourceOfChildStudy(t){return I.has(t)}static getStudyPropertyRootName(t){const e=m.get(t.id);if(void 0!==e)return e
;let i="study_"+t.id;return t.pine&&t.pine.version&&(i+="_"+t.pine.version.replace(".","_")),i}static getStudyPropertyRootNameById(t){const e=m.get(t);return void 0!==e?e:"study_"+t}static isScriptStrategy(t){if(t.extra&&t.extra.kind)return"strategy"===t.extra.kind;if(!0===t.isTVScriptStrategy)return!0;const e=t.TVScriptSourceCode||t.scriptSource;return!!e&&(0,y.isStrategy)(e)}static isReplayStrategy(t){return t.id===b}static parseIdString(t){return(0,f.parseIdString)(t)}static versionOf(t){const e="_metainfoVersion"in t&&(0,r.isNumber)(t._metainfoVersion)?t._metainfoVersion:0;return e<0&&h.logError("Metainfo format version cannot be negative: "+e),e}static getPackageName(t){const e=/^[^@]+@([^-]+-[^-]+)/.exec(t||"");e?.[1]||(0,u.getPersistentLogger)()?.addPersistentLogEntry(`getStudyPackageName: study id ${t} with stack ${(new Error).stack}`,a.LOGLEVEL.INFO,"chart.StudyMetaInfo");const[,i="tv-basicstudies"]=e||[];return i}static cutDollarHash(t){const e=t.indexOf("$");if(-1===e)return t;const i=t.indexOf("@"),s=i>=0?t.substring(i):"";return t.substring(0,e)+s}static hasPubSuffix(t){return/^PUB;.+$/.test(t)}static hasStdSuffix(t){return/^STD;.+$/.test(t)}static isStandardPine(t){return/^(Strategy)?Script\$STD;.*@tv-scripting$/.test(t)}static getStudyIdWithLatestVersion(t,e){const i=T.cutDollarHash(t.id);let s=i;return i.indexOf("Portfolio@tv-scripting")>=0?s+=e?"!":"":"ReplayStrategy@tv-scripting"===s?s+="-581!":i.indexOf("@tv-scripting")>=0?s+="-101!":i.endsWith("CP@tv-basicstudies")?s+="-"+Math.min(t.version,207):i.endsWith("CP@tv-chartpatterns")?s+="-"+Math.min(t.version,9):i.endsWith("@tv-volumebyprice")||e?s+="-"+t.version+"!":s+="-"+t.version,s}static overrideDefaults(t){0!==t.length&&(0,c.applyOverridesToStudyDefaults)(this.savedStudiesOverrides,t,(t=>window.TradingView.defaultProperties[T.getStudyPropertyRootName(t)]||null))}static mergeDefaultsOverrides(t){(0,r.merge)(this.savedStudiesOverrides,t)}static findStudyMetaInfoByDescription(t,e){if(t){const i=e.toLowerCase();for(const e of t)if(e.description.toLowerCase()===i)return e;throw new Error("unexpected study id:"+e)}throw new Error("There is no studies metainfo")}_updateInputDisplayDefaults(){this.inputs.filter((t=>void 0===t.display)).forEach((t=>{_.includes(t.type)?t.display=d.InputDisplayFlags.None:t.display=d.InputDisplayFlags.All}))}}T.savedStudiesOverrides={},window.TradingView.StudyMetaInfo=T},240448:(t,e,i)=>{var s;t=i.nmd(t),"undefined"!=typeof window&&(s=window.TVScript=window.TVScript||{}),(s=s||{}).Access={},s.Access.ACCESS_OPEN_NO_AUTH="open_no_auth",s.Access.ACCESS_CLOSED_NO_AUTH="closed_no_auth",s.Access.ACCESS_CLOSED_NEEDS_AUTH="closed_needs_auth",s.Access.MAP_ID_TO_NAME={1:s.Access.ACCESS_OPEN_NO_AUTH,2:s.Access.ACCESS_CLOSED_NO_AUTH,3:s.Access.ACCESS_CLOSED_NEEDS_AUTH},s.Access.MAP_NAME_TO_ID={},Object.keys(s.Access.MAP_ID_TO_NAME).forEach((function(t){s.Access.MAP_NAME_TO_ID[s.Access.MAP_ID_TO_NAME[t]]=t})),s.PinePrefix={},s.PinePrefix.USER="USER;",s.PinePrefix.PUB="PUB;",s.PinePrefix.STD="STD;",s.PinePrefix.TV="TV_",
s.PinePrefix.EDGR="EDGR_",s.PineType={},s.PineType.UserSaved="PineType_UserSaved",s.PineType.UserPublished="PineType_UserPublished",s.PineType.BuiltIn="PineType_BuiltIn",s.PineType.Addon="PineType_Addon",s.Type=s.Type||function(){},s.Type.VOID="void",s.Type.INTEGER="integer",s.Type.FLOAT="float",s.Type.STRING="string",s.Type.BOOL="bool",s.Type.COLOR="color",s.Type.SERIES="series",s.Type.PLOT="plot",s.Type.HLINE="hline",s.Type.BARCOLOR="barcolor",s.Type.BGCOLOR="bgcolor",s.Type.PLOTSHAPES="plotshape",s.Type.PLOTCHARS="plotchar",s.Type.PLOTARROWS="plotarrow",s.Type.NA="na",s.Type.ARRAY="array",s.TranslatorDefaultVersion=1,s.TranslatorReferenceVersioningIntroduced=4,s.TranslatorLastVersion=6,s.pineType=function(t){return t.startsWith(s.PinePrefix.USER)?s.PineType.UserSaved:t.startsWith(s.PinePrefix.PUB)?s.PineType.UserPublished:t.startsWith(s.PinePrefix.STD)||t.startsWith(s.PinePrefix.TV)||t.startsWith(s.PinePrefix.EDGR)?s.PineType.BuiltIn:s.PineType.Addon},s.patchILTemplate=function(t,e,i){var n=i||{};return s._patchTemplate(/<(in_\d+)>/g,t,e,n)},s.decorateQuotes=function(t){if(!t)return t;var e=/([^\\']+?)(')[^']*?/g,i="$1\\$2",s=t;return"'"==s.charAt(0)&&"'"==s.charAt(s.length-1)?"'"+(s=s.substr(1,s.length-2)).replace(e,i)+"'":s.replace(e,i)},s.patchInputs=function(t,e){var i={};for(var s in t)if(t.hasOwnProperty(s)){var n,r=t[s];n=r.isFake?{v:e[r.id],f:!0,t:r.type}:e[r.id],i[r.id]=n}return i},s._patchTemplate=function(t,e,i,n){var r=n||{};return e.replace(t,(function(t,e){for(var n=(e in r?r[e]:i.defaults.inputs[e]),o=0;o<i.inputs.length;++o)if(i.inputs[o].id===e)if("bool"===i.inputs[o].type)n=n?"1.0":"0.0";else if(["text","symbol","resolution","session"].indexOf(i.inputs[o].type)>=0)n="'"+s.decorateQuotes(n)+"'";else if("source"===i.inputs[o].type){var a=n.split("$");a[0]="'"+a[0]+"'",n="source("+a.join(",")+")"}return n}))},s.isStrategy=function(t){return/^\s*strategy\s*\(/m.test(t)};var n=/^\s*\/\/\s*?@version\s*?=\s*?(\S*?)\s*?$/gm,r=/^[0-9]+$/;s.extractVersion=function(t){n.lastIndex=0;var e=n.exec(t);if(null===e)return 1;var i=e[1],o=r.test(i)?Number(i):NaN;return isNaN(o)?1:Math.max(s.TranslatorDefaultVersion,Math.min(o,s.TranslatorLastVersion))},s.canUpgradeVersion=function(t){return t>=3&&t<s.TranslatorLastVersion},s.canDowngradeVersion=function(t){return t>=4&&t<=s.TranslatorLastVersion},t&&t.exports&&(t.exports=s)}}]);