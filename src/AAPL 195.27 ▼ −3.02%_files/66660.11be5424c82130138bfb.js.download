"use strict";(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[66660],{262600:(t,e,s)=>{s.d(e,{ChartSession:()=>n});var i=s(547465),r=s(126726);class n extends r.Session{constructor(t,e=!1){super(t,"cs",!1),this._sessionDisabled=!1,this._handler=null,this._criticalError=new i.Delegate,this._symbolResolveMap=new Map,this._lastSymbolResolveInfoMap=new Map,this._disableStatistics=e}destroy(){this._criticalError.destroy(),this._handler=null,this._symbolResolveMap.clear(),super.destroy()}switchTimezone(t){return this._getChartApi().switchTimezone(this.sessionId(),t)}defaultResolutions(){return this._getChartApi().defaultResolutions()}availableCurrencies(){return this._getChartApi().availableCurrencies()}availableUnits(){return this._getChartApi().availableUnits()}availablePriceSources(t){return this._getChartApi().availablePriceSources(t)}resolveSymbol(t,e,s){if(this._symbolResolveMap.has(e)){const[t,i]=this._symbolResolveMap.get(e);return Array.isArray(i)?i.push(s):i.then(s),t}{const i=[s];return this._getChartApi().resolveSymbol(this.sessionId(),t,e,(s=>{if("symbol_error"===s.method)this._symbolResolveMap.delete(e);else{this._symbolResolveMap.set(e,[t,Promise.resolve(s)]);const[,i]=s.params,r={pro_name:i.pro_name,ticker:i.ticker};this._lastSymbolResolveInfoMap.set(e,r),r.pro_name&&this._lastSymbolResolveInfoMap.set(r.pro_name,r),i.full_name&&this._lastSymbolResolveInfoMap.set(i.full_name,r),r.ticker&&this._lastSymbolResolveInfoMap.set(r.ticker,r)}i.forEach((t=>t(s)))})),this._symbolResolveMap.set(e,[t,i]),t}}requestFirstBarTime(t,e,s){return this._getChartApi().requestFirstBarTime(this.sessionId(),t,e,s)}lastSymbolResolveInfo(t){return this._lastSymbolResolveInfoMap.get(t)??null}createSeries(t,e,s,i,r,n,a){return this._getChartApi().createSeries(this.sessionId(),t,e,s,i,r,n,a)}modifySeries(t,e,s,i,r,n,a){return this._getChartApi().modifySeries(this.sessionId(),t,e,s,i,r,n,a)}removeSeries(t){return!!this.isConnected().value()&&this._getChartApi().removeSeries(this.sessionId(),t)}requestMoreData(t,e,s){return"number"==typeof t?this._getChartApi().requestMoreData(this.sessionId(),t):this._getChartApi().requestMoreData(this.sessionId(),t,e,s)}requestMoreTickmarks(t,e,s){return this._getChartApi().requestMoreTickmarks(this.sessionId(),t,e,s)}setFutureTickmarksMode(t){return this._getChartApi().setFutureTickmarksMode(this.sessionId(),t)}canCreateStudy(t,e){return this._getChartApi().canCreateStudy(this.sessionId(),t,e)}getStudyCounter(){return this._getChartApi().getStudyCounter(this.sessionId())}getFundamentalCounter(){return this._getChartApi().getFundamentalCounter(this.sessionId())}createStudy(t,e,s,i,r,n,a){return this._getChartApi().createStudy(this.sessionId(),t,e,s,i,r,n,a)}modifyStudy(t,e,s,i,r){return this._getChartApi().modifyStudy(this.sessionId(),t,e,s,i,r)}notifyStudy(t,e,s){return this._getChartApi().notifyStudy(this.sessionId(),t,e,s)}removeStudy(t){return this._getChartApi().removeStudy(this.sessionId(),t)}createPointset(t,e,s,i,r,n){
return this._getChartApi().createPointset(this.sessionId(),t,e,s,i,r,n)}modifyPointset(t,e,s,i){return this._getChartApi().modifyPointset(this.sessionId(),t,e,s,i)}removePointset(t){return this._getChartApi().removePointset(this.sessionId(),t)}setVisibleTimeRange(t,e,s,i,r,n,a){0}criticalError(){return this._criticalError}connect(t=null){null!==t&&(this._handler=t),this._symbolResolveMap.clear(),super.connect()}setHandler(t){this._handler=t}connected(){return this.isConnected().value()&&!this._sessionDisabled}disable(){this._sessionDisabled=!0}chartApi(){return this._getChartApi()}_sendCreateSession(){Object.keys(this).forEach((t=>{/^(s|st|symbol_)\d+$/.test(t)&&delete this[t]})),this._getChartApi().chartCreateSession(this.sessionId(),this._disableStatistics)}_sendRemoveSession(){this._getChartApi().chartDeleteSession(this.sessionId())}_onMessage(t){this._handler&&this._handler(t)}_onCriticalError(t,e){this._criticalError.fire(t,e),super._onCriticalError(t,e)}}},20019:(t,e,s)=>{s.d(e,{ConflatedChunksBuilder:()=>a});var i=s(650151),r=s(660439);const n=[{barsToMerge:10,forBarspacingLargerThen:.03},{barsToMerge:30,forBarspacingLargerThen:.01},{barsToMerge:100,forBarspacingLargerThen:.003},{barsToMerge:500,forBarspacingLargerThen:0}];class a{constructor(t,e){this._plots=t,this._conflatedChunks={chunks:new Map,priceSource:null,priceSourcesProvider:e},this._clearConflatedChunks()}conflatedChunks(t,e){if(e!==this._conflatedChunks.priceSource){this._conflatedChunks.priceSource=e;const t=this._plots.first();t&&(this._clearConflatedChunks(),this._rebuildConflatedChunks(t))}const s=(0,i.ensureDefined)(n.find((e=>e.forBarspacingLargerThen<=t)));return(0,i.ensureDefined)(this._conflatedChunks.chunks.get(s.barsToMerge))}mergeData(t){const e=this._plots.size(),s=this._plots.merge(t);return s&&null!==this._conflatedChunks.priceSource&&(e===this._plots.size()&&s.index===this._plots.lastIndex()?this._updateLatestChunks():this._rebuildConflatedChunks(s)),s}moveData(t){this._plots.move(t),this._plots.size()>0&&this._clearConflatedChunks()}clearData(){this._plots.clear(),this._clearConflatedChunks()}_rebuildConflatedChunks(t){const e=this._conflatedChunks.priceSource;if(null===e)return;const s=t.index,a=this._conflatedChunks.priceSourcesProvider(e),o=(t,e,s)=>{let i=null;for(const r of t){const t=a(r.value);i&&r.index-i.startTime>=s.barsToMerge&&(e.push(i),i=null),i?(i.endTime=r.index,i.high=Math.max(i.high,t),i.low=Math.min(i.low,t),i.close=t):i={startTime:r.index,endTime:r.index,open:t,high:t,low:t,close:t}}i&&e.push(i)};n.forEach((t=>{const e=(0,i.ensureDefined)(this._conflatedChunks.chunks.get(t.barsToMerge)),n=(0,r.lowerbound)(e,s,((t,e)=>t.endTime<e));if(0===n&&e.length>0){const s=e[0].startTime-1,r=(0,i.ensureNotNull)(this._plots.firstIndex()),n=this._plots.rangeIterator(r,s),a=[];o(n,a,t);const h=a.concat(e);this._conflatedChunks.chunks.set(t.barsToMerge,h)}else{const s=(0,i.ensureNotNull)(this._plots.lastIndex());e.splice(n);let r=(0,i.ensureNotNull)(this._plots.firstIndex());e.length&&(r=e[e.length-1].endTime+1)
;const a=this._plots.rangeIterator(r,s);o(a,e,t)}}))}_updateLatestChunks(){const t=(0,i.ensureNotNull)(this._plots.last()),e=this._conflatedChunks.priceSourcesProvider("close");n.forEach((s=>{const r=(0,i.ensureDefined)(this._conflatedChunks.chunks.get(s.barsToMerge)),n=e(t.value),a=r[r.length-1];a.high=Math.max(a.high,n),a.low=Math.min(a.low,n),a.close=n,a.endTime=t.index}))}_clearConflatedChunks(){n.forEach((t=>this._conflatedChunks.chunks.set(t.barsToMerge,[])))}}},584785:(t,e,s)=>{var i;s.d(e,{PlotRowSearchMode:()=>i}),function(t){t[t.NearestLeft=-1]="NearestLeft",t[t.Exact=0]="Exact",t[t.NearestRight=1]="NearestRight"}(i||(i={}))},847774:(t,e,s)=>{var i;s.d(e,{SymbolErrorPermissionDeniedReason:()=>i,invalidSymbol:()=>n,permissionDenied:()=>r}),function(t){t.Symbol="symbol",t.GroupPermission="group"}(i||(i={}));const r="permission denied",n="invalid symbol"},359035:(t,e,s)=>{s.d(e,{unpackNonSeriesData:()=>o});var i=s(130551),r=s(650151);function n(t){if(!(0,i.isObject)(t))throw new Error("Graphics commands should be wrapped in an object");if((0,i.hasProperty)(t,"create"),(0,i.hasProperty)(t,"erase")){const e=t.erase;(0,r.assert)(Array.isArray(e),"Collection of erase commands should be array");for(const t of e){if(!(0,i.isObject)(t)||!(0,i.hasProperty)(t,"action"))throw new Error("Command should be an object with 'action' property");(0,r.assert)("all"===t.action||"one"===t.action,"Erase command action should be 'all' or 'one'")}}return t}async function a(t){{const[{inflateZlib:e,inflateRaw:i},{unpackImpl:r}]=await Promise.all(["function"==typeof DecompressionStream?s.e(95465).then(s.bind(s,552243)):Promise.all([s.e(84069),s.e(82170)]).then(s.bind(s,392592)),s.e(95465).then(s.bind(s,321672))]);return r(e,i,t)}}async function o(t){if(""===t)return null;const e=JSON.parse(t);if(!(0,i.isObject)(e)||"function"==typeof e)throw new Error("Non-object content in the non-series envelope");if((0,i.hasProperty)(e,"indexes_replace"))return{indexes_replace:!0};const s={indexes_replace:!1};if((0,i.hasProperty)(e,"offsets")&&(s.offsets=e.offsets),(0,i.hasProperty)(e,"isUpdate")){if("boolean"!=typeof e.isUpdate)throw new Error('Invalid type of "isUpdate" field');s.isUpdate=e.isUpdate}return(0,i.hasProperty)(e,"data")&&(s.data=e.data),(0,i.hasProperty)(e,"graphicsCmds")&&(s.graphicsCmds=n(e.graphicsCmds)),(0,i.hasProperty)(e,"dataCompressed")&&(s.data=await a(e.dataCompressed)),(0,i.hasProperty)(e,"graphicsCmdsCompressed")&&(s.graphicsCmds=n(await a(e.graphicsCmdsCompressed))),s}},132565:(t,e,s)=>{s.d(e,{PlotList:()=>_,mergeMinMax:()=>u});var i=s(650151),r=s(660439),n=s(707771),a=s(735566),o=s(584785);const h=(0,a.getLogger)("Chart.PlotList"),l=30;function d(t){return t.index}function c(t){return t.value[0]}class _{constructor(t=null,e=null){this._items=[],this._start=0,this._end=0,this._shareRead=!1,this._minMaxCache=new Map,this._rowSearchCacheByIndex=new Map,this._rowSearchCacheByIndexWithoutEmptyValues=new Map,this._rowSearchCacheByTime=new Map,this._rowSearchCacheByTimeWithoutEmptyValues=new Map,this._plotFunctions=t||new Map,
this._emptyValuePredicate=e}clear(){this._items=[],this._start=0,this._end=0,this._shareRead=!1,this._minMaxCache.clear(),this._invalidateSearchCaches()}first(){return this.size()>0?this._items[this._start]:null}last(){return this.size()>0?this._items[this._end-1]:null}firstIndex(){return this.size()>0?this._indexAt(this._start):null}lastIndex(){return this.size()>0?this._indexAt(this._end-1):null}clone(){const t=this.firstIndex(),e=this.lastIndex();return null===t||null===e?new _:this.range(t,e)}size(){return this._end-this._start}isEmpty(){return 0===this.size()}contains(t){return null!==this.search(t,o.PlotRowSearchMode.Exact)}valueAt(t){const e=this.search(t);return null!==e?e.value:null}add(t,e){if(this._shareRead)return h.logDebug("add: readonly collection modification attempt"),!1;const s={index:t,value:e},i=this._nonCachedSearch(t,o.PlotRowSearchMode.Exact,d);return this._invalidateSearchCaches(),null===i?(this._items.splice(this._lowerbound(t,d),0,s),this._start=0,this._end=this._items.length,!0):(this._items[i]=s,!1)}search(t,e=o.PlotRowSearchMode.Exact,s){return this._searchImpl(t,e,this._rowSearchCacheByIndex,this._rowSearchCacheByIndexWithoutEmptyValues,d,s)}searchByTime(t,e=o.PlotRowSearchMode.Exact,s){return this._searchImpl(t,e,this._rowSearchCacheByTime,this._rowSearchCacheByTimeWithoutEmptyValues,c,s)}fold(t,e){let s=e;for(let e=this._start;e<this._end;++e){s=t(this._indexAt(e),this._valueAt(e),s)}return s}findFirst(t,e){const s=void 0!==e&&Math.min(this._start+e,this._end)||this._end;for(let e=this._start;e<s;++e){const s=this._indexAt(e),i=this._valueAt(e);if(t(s,i))return{index:s,value:i}}return null}findLast(t,e){const s=void 0!==e&&Math.max(this._end-e,this._start)||this._start;for(let e=this._end-1;e>=s;--e){const s=this._indexAt(e),i=this._valueAt(e);if(t(s,i))return{index:s,value:i}}return null}each(t){for(let e=this._start;e<this._end;++e){if(t(this._indexAt(e),this._valueAt(e)))break}}reduce(t,e){let s=e;for(let e=this._start;e<this._end;++e){s=t(s,this._indexAt(e),this._valueAt(e))}return s}range(t,e){const s=new _(this._plotFunctions,this._emptyValuePredicate);return s._items=this._items,s._start=this._lowerbound(t,d),s._end=this._upperbound(e),s._shareRead=!0,s}plottableRange(t){const e=new _(this._plotFunctions,this._emptyValuePredicate);return e._items=this._items,e._start=this._upperbound(n.UNPLOTTABLE_TIME_POINT_INDEX),e._end=this._end,e._shareRead=!0,!0===t&&e._start>this._start&&(e._start-=1),e}rangeCountback(t,e){if(null===this.firstIndex())return new _;const s=new _(this._plotFunctions,this._emptyValuePredicate);return s._items=this._items,s._end=this._upperbound(t),s._start=Math.max(this._start,s._end-e),s._shareRead=!0,s}rangeIterator(t,e){const s=this._lowerbound(t,d),i=this._upperbound(e);return this._rangeIteratorImpl(s,i)}fullRangeIterator(){return this._rangeIteratorImpl(this._start,this._end)}minMaxOnRangeCached(t,e,s){if(this.isEmpty())return null;let i=null;for(const r of s){i=u(i,this._minMaxOnRangeCachedImpl(t-r.offset,e-r.offset,r.name))}return i}
minMaxOnRange(t,e,s){if(this.isEmpty())return null;let i=null;for(const r of s){i=u(i,this._minMaxOnRange(t-r.offset,e-r.offset,r.name))}return i}merge(t){return this._shareRead?(h.logDebug("merge: readonly collection modification attempt"),null):0===t.length?null:this.isEmpty()||t[t.length-1].index<this._items[0].index?this._prepend(t):t[0].index>this._items[this._items.length-1].index?this._append(t):1===t.length&&t[0].index===this._items[this._items.length-1].index?(this._updateLast(t[0]),t[0]):this._merge(t)}addTail(t,e=!1){if(0===t.length)return;let s=0;e&&this._end-this._start>0&&(s=1,this._items[this._end-this._start-1].value=t[0].value);for(let e=s;e<t.length;++e){const s=t[e],i=this.lastIndex();if(null===i){h.logError("Can't add tail to the empty plotlist");break}this.add(i+1,s.value)}this._invalidateSearchCaches()}move(t){if(this._shareRead)return void h.logDebug("move: readonly collection modification attempt");if(0===t.length)return;const e=this._items.slice();for(const s of t){const t=this._bsearch(s.old,d);if(null!==t&&void 0!==e[t])if(s.new===n.INVALID_TIME_POINT_INDEX)e[t]=void 0;else{e[t]={index:s.new,value:e[t].value};const i=this._bsearch(s.new,d);if(null!==i){const t=e[i];void 0!==t&&t.index===s.new&&(e[i]=void 0)}}}this._items=e.filter((t=>void 0!==t)).sort(((t,e)=>t.index-e.index)),this._invalidateSearchCaches(),this._minMaxCache.clear(),this._start=0,this._end=this._items.length}remove(t){if(this._shareRead)return h.logDebug("remove: readonly collection modification attempt"),null;const e=this._nonCachedSearch(t,o.PlotRowSearchMode.NearestRight,d);if(null===e)return null;const s=this._items.splice(e);return this._end=this._items.length,this._minMaxCache.clear(),this._invalidateSearchCaches(),s.length>0?s[0]:null}state(){const t=this._items.slice(this._start,this._end);return{start:0,end:t.length,data:t}}restoreState(t){t?(this._start=t.start,this._end=t.end,this._shareRead=!1,this._items=t.data,this._minMaxCache.clear(),this._invalidateSearchCaches()):this.clear()}_indexAt(t){return this._items[t].index}_valueAt(t){return this._items[t].value}_length(){return this._items.length}_searchImpl(t,e,s,i,r,n){const a=void 0!==n?s:i,o=void 0!==n?1e4*(e+1)+n:e;let h=a.get(t);if(void 0!==h){const t=h.get(o);if(void 0!==t)return t}const l=this._nonCachedSearch(t,e,r,n);if(null===l)return null;const d={index:this._indexAt(l),value:this._valueAt(l)};return void 0===h&&(h=new Map,a.set(t,h)),h.set(o,d),d}_nonCachedSearch(t,e,s,i){const r=this._lowerbound(t,s),n=r===this._end||t!==s(this._items[r]);if(n&&e!==o.PlotRowSearchMode.Exact)switch(e){case o.PlotRowSearchMode.NearestLeft:return this._searchNearestLeft(r,i);case o.PlotRowSearchMode.NearestRight:return this._searchNearestRight(r,i);default:throw new TypeError("Unknown search mode")}if(void 0===i||n||e===o.PlotRowSearchMode.Exact)return n?null:r;switch(e){case o.PlotRowSearchMode.NearestLeft:return this._nonEmptyNearestLeft(r,i);case o.PlotRowSearchMode.NearestRight:return this._nonEmptyNearestRight(r,i);default:
throw new TypeError("Unknown search mode")}}_nonEmptyNearestRight(t,e){const s=(0,i.ensure)(this._emptyValuePredicate),r=(0,i.ensure)(e);for(;t<this._end&&s(this._valueAt(t),r);)t+=1;return t===this._end?null:t}_nonEmptyNearestLeft(t,e){const s=(0,i.ensureNotNull)(this._emptyValuePredicate),r=(0,i.ensure)(e);for(;t>=this._start&&s(this._valueAt(t),r);)t-=1;return t<this._start?null:t}_searchNearestLeft(t,e){if(t===this._start)return null;const s=t-1,i=s!==this._end?s:null;return void 0!==e&&null!==i?this._nonEmptyNearestLeft(i,e):i}_searchNearestRight(t,e){const s=t,i=s!==this._end?s:null;return void 0!==e&&null!==i?this._nonEmptyNearestRight(i,e):i}_bsearch(t,e){const s=this._lowerbound(t,e);return s!==this._end&&t===e(this._items[s])?s:null}_lowerbound(t,e){return(0,r.lowerbound)(this._items,t,((t,s)=>e(t)<s),this._start,this._end)}_upperbound(t){return(0,r.upperbound)(this._items,t,((t,e)=>e.index>t),this._start,this._end)}_plotMinMax(t,e,s){let i=null;const r=this._plotFunctions.get(s);if(void 0===r)throw new Error(`Plot "${s}" is not registered`);for(let s=t;s<e;s++){const t=r(this._items[s].value);null==t||Number.isNaN(t)||(null===i?i={min:t,max:t}:(t<i.min&&(i.min=t),t>i.max&&(i.max=t)))}return i}_invalidateCacheForRow(t){const e=Math.floor(t.index/l);this._minMaxCache.forEach((t=>t.delete(e)))}_prepend(t){return(0,i.assert)(!this._shareRead,"collection should not be readonly"),(0,i.assert)(0!==t.length,"plotRows should not be empty"),this._invalidateSearchCaches(),this._minMaxCache.clear(),this._items=t.concat(this._items),this._start=0,this._end=this._items.length,t[0]}_append(t){return(0,i.assert)(!this._shareRead,"collection should not be readonly"),(0,i.assert)(0!==t.length,"plotRows should not be empty"),this._invalidateSearchCaches(),this._minMaxCache.clear(),this._items=this._items.concat(t),this._start=0,this._end=this._items.length,t[0]}_updateLast(t){(0,i.assert)(!this.isEmpty(),"plot list should not be empty");const e=this._items[this._end-1];(0,i.assert)(e.index===t.index,"last row index should match new row index"),this._invalidateCacheForRow(t),this._invalidateSearchCaches(),this._items[this._end-1]=t}_merge(t){return(0,i.assert)(0!==t.length,"plot rows should not be empty"),this._invalidateSearchCaches(),this._minMaxCache.clear(),this._items=function(t,e){const s=function(t,e){const s=t.length,i=e.length;let r=s+i,n=0,a=0;for(;n<s&&a<i;)t[n].index<e[a].index?n++:t[n].index>e[a].index?a++:(n++,a++,r--);return r}(t,e),i=new Array(s);let r=0,n=0;const a=t.length,o=e.length;let h=0;for(;r<a&&n<o;)t[r].index<e[n].index?(i[h]=t[r],r++):t[r].index>e[n].index?(i[h]=e[n],n++):(i[h]=e[n],r++,n++),h++;for(;r<a;)i[h]=t[r],r++,h++;for(;n<o;)i[h]=e[n],n++,h++;return i}(this._items,t),this._start=0,this._end=this._items.length,t[0]}_minMaxOnRangeCachedImpl(t,e,s){if(this.isEmpty())return null;let r=null;const n=(0,i.ensureNotNull)(this.firstIndex()),a=(0,i.ensureNotNull)(this.lastIndex()),o=Math.max(t,n),h=Math.min(e,a),d=Math.ceil(o/l)*l,c=Math.max(d,Math.floor(h/l)*l)
;r=u(r,this._minMaxOnRange(o,Math.min(d,e,h),s));let _=this._minMaxCache.get(s);void 0===_&&(_=new Map,this._minMaxCache.set(s,_));for(let t=Math.max(d+1,o);t<c;t+=l){const e=Math.floor(t/l);let i=_.get(e);if(void 0===i){const t=e*l,r=(e+1)*l-1;i=this._minMaxOnRange(t,r,s),_.set(e,i)}r=u(r,i)}r=u(r,this._minMaxOnRange(c,h,s));return r}_minMaxOnRange(t,e,s){return this._plotMinMax(this._lowerbound(t,d),this._upperbound(e),s)}_rangeIteratorImpl(t,e){let s=t-1;return{[Symbol.iterator](){return this},next:()=>(s+=1,s>=e?{done:!0,value:void 0}:{done:!1,value:this._items[s]})}}_invalidateSearchCaches(){this._rowSearchCacheByIndex.clear(),this._rowSearchCacheByIndexWithoutEmptyValues.clear(),this._rowSearchCacheByTime.clear(),this._rowSearchCacheByTimeWithoutEmptyValues.clear()}}function u(t,e){if(null===t)return e;if(null===e)return t;return{min:Math.min(t.min,e.min),max:Math.max(t.max,e.max)}}},326488:(t,e,s)=>{s.d(e,{SeriesData:()=>_,barFunction:()=>d,barFunctions:()=>h,seriesPlotFunctionMap:()=>l});var i,r=s(650151),n=s(132565),a=s(20019);!function(t){t[t.FromLeft=-1]="FromLeft",t[t.FromRight=1]="FromRight"}(i||(i={}));const o=["open","high","low","close","hl2","hlc3","ohlc4"],h={open:t=>t[1],high:t=>t[2],low:t=>t[3],close:t=>t[4],hl2:t=>(t[2]+t[3])/2,hlc3:t=>(t[2]+t[3]+t[4])/3,ohlc4:t=>(t[1]+t[2]+t[3]+t[4])/4};function l(){const t=new Map;return o.forEach(((e,s)=>{t.set(e,d(e))})),t}function d(t,e,s){const i=h[e??t],r=h[t],n=h[s??t];return(t,e)=>{switch(e){case 0:return i(t);case 2:return n(t);default:return r(t)}}}function c(t,e){return null==t[e]}class _{constructor(){this.m_bars=new n.PlotList(l(),c),this.m_nsBars=new n.PlotList(l(),c),this._conflatedChunksBuilder=new a.ConflatedChunksBuilder(this.m_bars,(t=>h[t]))}bars(){return this.m_bars}nsBars(){return this.m_nsBars}conflatedChunks(t,e){return this._conflatedChunksBuilder.conflatedChunks(t,e)}mergeRegularBars(t){return this._conflatedChunksBuilder.mergeData(t)}size(){return this.m_bars.size()+this.m_nsBars.size()}each(t){this.m_bars.each(t),this.m_nsBars.each(t)}clear(){this.m_nsBars.clear(),this.lastProjectionPrice=void 0,this._conflatedChunksBuilder.clearData()}clone(){const t=new _;return t.lastProjectionPrice=this.lastProjectionPrice,t.boxSize=this.boxSize,t.reversalAmount=this.reversalAmount,t.m_bars=this.m_bars.clone(),t.m_nsBars=this.m_bars.clone(),t}isEmpty(){return this.m_bars.isEmpty()&&this.m_nsBars.isEmpty()}first(){return this.m_bars.isEmpty()?this.m_nsBars.first():this.m_bars.first()}last(){return this.m_nsBars.isEmpty()?this.m_bars.last():this.m_nsBars.last()}search(t,e,s){return this.nsBars().isEmpty()?this.bars().search(t,e,s):this.bars().isEmpty()||(0,r.ensureNotNull)(this.nsBars().firstIndex())<=t?this.nsBars().search(t,e,s):this.bars().search(t,e,s)}valueAt(t){const e=this.search(t);return null!==e?e.value:null}plotValueToTimePointIndex(t,e,s){if(s===i.FromRight){const s=(s,i)=>{const r=i[e];return null!=r&&t>=r},i=this.m_bars.findLast(s);if(null!==i)return i.index;const r=this.m_nsBars.findLast(s)
;return null!==r?r.index:this.m_bars.firstIndex()}if(s===i.FromLeft){const s=(s,i)=>{const r=i[e];return null!=r&&t<=r},i=this.m_bars.findFirst(s);if(null!==i)return i.index;const r=this.m_nsBars.findFirst(s);return null!==r?r.index:this.m_bars.lastIndex()}throw new Error("plotValueToTimePointIndex: unsupported search mode")}moveData(t){this._conflatedChunksBuilder.moveData(t),this.m_nsBars.move(t)}}},535422:(t,e,s)=>{s.d(e,{SeriesDataSource:()=>I,initialRequestOptionsToNumBars:()=>v,parseJapaneseProjectionBars:()=>x});var i=s(650151),r=s(536794),n=s(955722),a=s(477786),o=s(326488),h=s(359035),l=s(847774),d=s(547465);class c{constructor(){this._created=new d.Delegate,this._modified=new d.Delegate,this._loading=new d.Delegate,this._completed=new d.Delegate,this._error=new d.Delegate,this._symbolError=new d.Delegate,this._symbolResolved=new d.Delegate,this._seriesError=new d.Delegate,this._symbolNotPermitted=new d.Delegate,this._symbolInvalid=new d.Delegate,this._symbolGroupNotPermitted=new d.Delegate,this._chartTypeNotPermitted=new d.Delegate,this._intradaySpreadNotPermitted=new d.Delegate,this._intradayExchangeNotPermitted=new d.Delegate,this._customIntervalNotPermitted=new d.Delegate,this._secondsIntervalNotPermitted=new d.Delegate,this._ticksIntervalNotPermitted=new d.Delegate,this._barReceived=new d.Delegate,this._seriesTimeFrame=new d.Delegate,this._dataUpdated=new d.Delegate,this._unsupportedResolutionRequested=new d.Delegate}destroy(){this._created.destroy(),this._modified.destroy(),this._loading.destroy(),this._completed.destroy(),this._error.destroy(),this._symbolError.destroy(),this._symbolResolved.destroy(),this._seriesError.destroy(),this._symbolInvalid.destroy(),this._symbolNotPermitted.destroy(),this._symbolGroupNotPermitted.destroy(),this._chartTypeNotPermitted.destroy(),this._intradaySpreadNotPermitted.destroy(),this._intradayExchangeNotPermitted.destroy(),this._customIntervalNotPermitted.destroy(),this._secondsIntervalNotPermitted.destroy(),this._ticksIntervalNotPermitted.destroy(),this._barReceived.destroy(),this._seriesTimeFrame.destroy(),this._dataUpdated.destroy(),this._unsupportedResolutionRequested.destroy()}created(){return this._created}modified(){return this._modified}loading(){return this._loading}completed(){return this._completed}error(){return this._error}symbolError(){return this._symbolError}symbolResolved(){return this._symbolResolved}seriesError(){return this._seriesError}symbolInvalid(){return this._symbolInvalid}symbolNotPermitted(){return this._symbolNotPermitted}symbolGroupNotPermitted(){return this._symbolGroupNotPermitted}chartTypeNotPermitted(){return this._chartTypeNotPermitted}intradaySpreadNotPermitted(){return this._intradaySpreadNotPermitted}intradayExchangeNotPermitted(){return this._intradayExchangeNotPermitted}customIntervalNotPermitted(){return this._customIntervalNotPermitted}secondsIntervalNotPermitted(){return this._secondsIntervalNotPermitted}ticksIntervalNotPermitted(){return this._ticksIntervalNotPermitted}barReceived(){return this._barReceived}seriesTimeFrame(){
return this._seriesTimeFrame}dataUpdated(){return this._dataUpdated}unsupportedResolutionRequested(){return this._unsupportedResolutionRequested}fireCompleted(t){this._completed.fire(t)}fireCreated(t){this._created.fire(t)}fireModified(){this._modified.fire()}fireLoading(t){this._loading.fire(t)}fireError(){this._error.fire()}fireSymbolError(t){this._symbolError.fire(t),this.fireError()}fireSymbolResolved(t){this._symbolResolved.fire(t)}fireSeriesError(t){this._seriesError.fire(t),this.fireError()}fireSymbolInvalid(){this._symbolInvalid.fire()}fireSymbolNotPermitted(t){this._symbolNotPermitted.fire(t)}fireSymbolGroupNotPermitted(t){this._symbolGroupNotPermitted.fire(t)}fireChartTypeNotPermitted(t){this._chartTypeNotPermitted.fire(t),this.fireError()}fireIntradaySpreadNotPermitted(){this._intradaySpreadNotPermitted.fire(),this.fireError()}fireIntradayExchangeNotPermitted(){this._intradayExchangeNotPermitted.fire(),this.fireError()}fireCustomIntervalNotPermitted(t){this._customIntervalNotPermitted.fire(t),this.fireError()}fireSecondsIntervalNotPermitted(){this._secondsIntervalNotPermitted.fire(),this.fireError()}fireTicksIntervalNotPermitted(){this._ticksIntervalNotPermitted.fire(),this.fireError()}fireBarReceived(t){this._barReceived.fire(t)}fireSeriesTimeFrame(t,e,s,i,r){this._seriesTimeFrame.fire(t,e,s,i,r)}fireDataUpdated(t,e,s,i,r){this._dataUpdated.fire(t,e,s,i,r)}fireUnsupportedResolutionRequested(){this._unsupportedResolutionRequested.fire()}}var _=s(735566),u=s(388741),m=s(641208);const p=(0,_.getLogger)("Chart.SeriesDataSource");var f;!function(t){t[t.Idle=0]="Idle",t[t.AwaitingConnection=1]="AwaitingConnection",t[t.AwaitingFirstDataUpdate=2]="AwaitingFirstDataUpdate",t[t.Active=3]="Active"}(f||(f={}));let g=1;let y=1;const b=300;function v(t){return t.startDate?t.endDate||t.count?t.endDate?["from_to",t.startDate,t.endDate]:["bar_count",t.startDate,(0,i.ensure)(t.count)]:["from_to",t.startDate]:t.count||b}function S(t){return(0,r.isString)(t.symbol)?t.symbol:t.symbol.symbol}function C(t,e){(0,r.isString)(t.symbol)?t.symbol=e:t.symbol.symbol=e}class I{constructor(t,e,s,i){this._extSymbol=null,this._lastResolvedSymbol="",this._createSeriesOverriddenParams=0,this._instanceId=null,this._symbolInstanceId=null,this._resolution=null,this._timeFrame=null,this._data=new o.SeriesData,this._dataEvents=new c,this._status=f.Idle,this._turnaroundCounter=1,this._boundOnGatewayIsConnectedChanged=this._onGatewayIsConnectedChanged.bind(this),this._ongoingDataUpdate=Promise.resolve(),this._gateway=t,this._turnaroundPrefix=e,this._createSeriesParams=v(s??{count:b}),this._timeFrame=i||null,this._gateway.isConnected().subscribe(this._boundOnGatewayIsConnectedChanged)}destroy(){this.stop(),this._gateway.isConnected().unsubscribe(this._boundOnGatewayIsConnectedChanged),this._dataEvents.destroy()}modifySeries(t,e,s=null,n=!1,o=null){n&&(p.logNormal("Due to force flag clearing symbol & resolution to force re-requesting data."),this._extSymbol=null,this._resolution=null);const h=S(t),l=!this.symbolSameAsResolved(h)
;if(l&&(this._lastResolvedSymbol=""),this._extSymbol&&!l){C(t,S(this._extSymbol))}const d=this._extSymbol,c=this._resolution;if(this._extSymbol=t,this._resolution=e,null===this._instanceId)return void(this._timeFrame=s);const _=!(0,r.deepEquals)(d,t)[0];_&&C(this._extSymbol,h);const u=null===c||!a.Interval.isEqual(c,e);(_||u||null!==s)&&(this._timeFrame=null,(_||u)&&this._turnaroundCounter++,_&&this._resolveSymbol(),this._gateway.modifySeries(this._instanceId,this.turnaround(),(0,i.ensureNotNull)(this._symbolInstanceId),this._resolution,o,s,this._onMessage.bind(this)),this._dataEvents.fireModified())}requestMoreData(t){null!==this._instanceId&&this._gateway.requestMoreData(this._instanceId,t,this._onMessage.bind(this))}requestMoreTickmarks(t){null!==this._instanceId&&this._gateway.requestMoreTickmarks(this._instanceId,t,this._onMessage.bind(this))}setFutureTickmarksMode(t){null!==this._instanceId&&this._gateway.setFutureTickmarksMode(t)}isStarted(){return this._status!==f.Idle}isActive(){return this._status===f.Active}resolution(){return this._resolution}start(){this.isStarted()?p.logNormal("start: data source is already started, nothing to do"):((0,i.assert)(null!==this._extSymbol,"symbol must be set before start"),(0,i.assert)(null!==this._resolution,"resolution must be set before start"),this._gateway.isConnected().value()?this._createSeries():this._changeStatusTo(f.AwaitingConnection))}stop(){this.isStarted()?(null!==this._instanceId&&(this._gateway.removeSeries(this._instanceId),this._instanceId=null),this._symbolInstanceId=null,this._changeStatusTo(f.Idle)):p.logNormal("stop: data source is already stopped, nothing to do")}instanceId(){return this._instanceId}data(){return this._data}setData(t){this._data=t}clearData(){this.isStarted()?this._enqueueUpdate((()=>this._clearDataImpl())):this._clearDataImpl()}dataEvents(){return this._dataEvents}turnaround(){return`${this._turnaroundPrefix}${this._turnaroundCounter}`}symbolInstanceId(){return this._symbolInstanceId}symbol(){return this._extSymbol}moveData(t){this._enqueueUpdate((()=>this._data.moveData(t)))}setInitialRequestOptions(t){this._createSeriesOverriddenParams=v(t)}symbolSameAsResolved(t){return null!==this._extSymbol&&(0,m.symbolSameAsResolved)(t,S(this._extSymbol),this._lastResolvedSymbol)}resolvedSymbol(){return null===this._extSymbol?null:S(this._extSymbol)}_resolveSymbol(){null!==this._extSymbol&&(this._symbolInstanceId=this._gateway.resolveSymbol("sds_sym_"+g++,(0,n.encodeExtendedSymbolOrGetSimpleSymbolString)(this._extSymbol),this._onMessage.bind(this)))}_clearDataImpl(){this._data.clear()}_changeStatusTo(t){(0,i.assert)(this._status!==t,"Source and destination status should be distinct"),p.logNormal(`Status changed from ${f[this._status]} to ${f[t]}`),this._status=t}_createSeries(){(0,i.assert)(this._status!==f.Active,'Status should not be "Active" when creating a study'),this._instanceId="sds_"+y++,this._resolveSymbol();const t=this._createSeriesOverriddenParams||this._createSeriesParams
;this._createSeriesOverriddenParams&&(this._createSeriesOverriddenParams=0),this._gateway.createSeries(this._instanceId,this.turnaround(),(0,i.ensureNotNull)(this._symbolInstanceId),(0,i.ensureNotNull)(this._resolution),t,this._timeFrame,this._onMessage.bind(this)),this._timeFrame=null,this._changeStatusTo(f.AwaitingFirstDataUpdate),this._dataEvents.fireCreated(this._instanceId)}_onGatewayIsConnectedChanged(t){t?this._onGatewayConnected():this._onGatewayDisconnected()}_onGatewayConnected(){this._status===f.AwaitingConnection&&this._createSeries()}_onGatewayDisconnected(){this._status!==f.Idle&&this._status!==f.AwaitingConnection&&(this._instanceId=null,this._changeStatusTo(f.AwaitingConnection)),this._turnaroundCounter=1}_onMessage(t){this._enqueueUpdate((()=>this._onMessageImpl(t)))}async _onMessageImpl(t){switch(t.method){case"symbol_resolved":{const[e,s]=t.params;if(e!==this._symbolInstanceId){null!==this._symbolInstanceId&&p.logNormal(`Resolve for old symbol, expected: ${this._symbolInstanceId}, actual ${t.params[0]}`);break}this._onSymbolResolved(s);break}case"symbol_error":if(t.params[0]!==this._symbolInstanceId){null!==this._symbolInstanceId&&p.logNormal(`Symbol error for old symbol, expected: ${this._symbolInstanceId}, actual ${t.params[0]}`);break}this._onSymbolError(t);break;case"series_timeframe":{const[e,s,i,r,n,a,o]=t.params;if(!this._checkTurnaround(e,s)){p.logNormal(`Time frame for old data, expected: ${this._symbolInstanceId} (${this.turnaround()}), actual ${e} (${s})`);break}this._onSeriesTimeFrame(i,r,n,a,o);break}case"series_error":{const[e,s]=t.params;if(!this._checkTurnaround(e,s)){p.logNormal(`Series error for old data, expected: ${this._symbolInstanceId} (${this.turnaround()}), actual ${e} (${s})`);break}this._onSeriesError(t.params[2]);break}case"series_loading":{const[e,s]=t.params;if(!this._checkTurnaround(e,s))break;this._onSeriesLoading(t.time);break}case"series_completed":{const[e,s,i,r]=t.params;if(!this._checkTurnaround(e,i)){p.logNormal(`Series completed for old data, expected: ${this._symbolInstanceId} (${this.turnaround()}), actual ${e} (${i})`);break}this._onSeriesCompleted(s,t.time,r);break}case"data_update":if(!this._checkTurnaround(t.params.customId,t.params.turnaround)){p.logNormal(`Data update for old data, expected: ${this._symbolInstanceId} (${this.turnaround()}), actual ${t.params.customId} (${t.params.turnaround})`);break}await this._onDataUpdate(t.params.plots,t.params.nonseries,t.params.lastBar);break;case"clear_data":{if(t.params.turnaround!==this.turnaround()){p.logNormal(`Clear data for old data, expected: ${this.turnaround()}, actual ${t.params.turnaround}`);break}const e=this._data.first();this._clearDataImpl(),this._dataEvents.fireDataUpdated(void 0,!1,null,!1,e);break}}}_onSeriesError(t){let e,s;if("string"==typeof t)s={error:t},e=t;else if(s=t,t.ctx){const s={};Object.entries(t.ctx).forEach((([t,e])=>{s[t]=e.toString()})),e=t.error.format(s)}else e=t.error;if(e.startsWith("study_not_auth:")){const t=e.split(":",2)[1].split("@",2)[0]
;if(["BarSetRenko","BarSetPriceBreak","BarSetKagi","BarSetPnF"].includes(t))this._dataEvents.fireChartTypeNotPermitted(t);else{if("BarSetSpread"===t)return void this._dataEvents.fireIntradaySpreadNotPermitted();if("BarSetRange"===t){const t=`${(0,i.ensureNotNull)(this._extSymbol).inputs.range}R`;this._dataEvents.fireCustomIntervalNotPermitted(t)}}}else{if(e.startsWith("unsupported"))return void this._dataEvents.fireUnsupportedResolutionRequested();"resolution_not_entitled"===e?this._dataEvents.fireIntradayExchangeNotPermitted():"custom_resolution"===e?this._dataEvents.fireCustomIntervalNotPermitted((0,i.ensureNotNull)(this._resolution)):"seconds_not_entitled"===e?this._dataEvents.fireSecondsIntervalNotPermitted():"ticks_not_entitled"===e&&this._dataEvents.fireTicksIntervalNotPermitted()}this._dataEvents.fireSeriesError(s)}_onSeriesTimeFrame(t,e,s,i,r){this._dataEvents.fireSeriesTimeFrame(t,e,s,i??!0,r)}_onSymbolError(t){if(t.params[1]===l.permissionDenied)switch(t.params[2]){case l.SymbolErrorPermissionDeniedReason.Symbol:this._dataEvents.fireSymbolNotPermitted(t.params[3]);break;case l.SymbolErrorPermissionDeniedReason.GroupPermission:this._dataEvents.fireSymbolGroupNotPermitted(t.params[3]);break;default:this._dataEvents.fireSymbolNotPermitted(t.params[2])}else t.params[1]===l.invalidSymbol&&this._dataEvents.fireSymbolInvalid();this._dataEvents.fireSymbolError(t.params[1])}_onSymbolResolved(t){this._lastResolvedSymbol=(0,i.ensureNotNull)((0,u.extractSymbolNameFromSymbolInfo)(t,"")),this._dataEvents.fireSymbolResolved(t)}async _onDataUpdate(t,e,s){this._onDataUnpacked(t,s,await x(e))}_enqueueUpdate(t){return this._ongoingDataUpdate=this._ongoingDataUpdate.then(t,t),this._ongoingDataUpdate}_onDataUnpacked(t,e,s){if(this._status===f.Idle)return;this._status===f.AwaitingFirstDataUpdate&&(this._changeStatusTo(f.Active),this._clearDataImpl());const i=this._data.bars().size(),r=this._data.first(),n=this._data.bars().firstIndex(),a=this._data.mergeRegularBars(t);null!==s&&(this._data.nsBars().clear(),this._data.nsBars().merge(s.projectionPlots),this._data.lastProjectionPrice=s.lastPrice,null!==s.boxSize&&(this._data.boxSize=s.boxSize),this._data.reversalAmount=s.reversalAmount);const o=null===n,h=o||null!==a&&a.index<n;this._dataEvents.fireDataUpdated(e,h,a,o,r),i!==this._data.bars().size()&&null!==a&&this._dataEvents.fireBarReceived(a)}_onSeriesLoading(t){this._dataEvents.fireLoading(t)}_onSeriesCompleted(t,e,s){this._dataEvents.fireCompleted({updateMode:t,time:e,flags:s})}_checkTurnaround(t,e){return this._instanceId===t&&(void 0===e||e===this.turnaround())}}async function x(t){if(void 0===t)return{projectionPlots:[],boxSize:null};if(""===t.d||"nochange"===t.indexes)return null;const e=await(0,h.unpackNonSeriesData)(t.d);if(null===e||e.indexes_replace)return null;const s=t.indexes,{bars:i,price:r,boxSize:n,reversalAmount:a}=e.data;return{lastPrice:r,projectionPlots:(i||[]).map((t=>{let e;return"factor"in t?e=t.factor:"additionalPrice"in t&&(e=t.additionalPrice),{index:s[t.time],
value:[0,t.open,t.high,t.low,t.close,t.volume,e]}})),reversalAmount:a,boxSize:n}}},126726:(t,e,s)=>{s.d(e,{Session:()=>h});var i=s(650151),r=s(820028),n=s(547465),a=s(623213);const o=(0,s(735566).getLogger)("ChartApi.AbstractSession");class h{constructor(t,e,s){this._isConnected=new r.WatchedValue(!1),this._state=0,this._isConnectForbidden=!1,this._sessionId="",this._sessionIdChanged=new n.Delegate,this._chartApi=t,this._sessionPrefix=e,this._shouldReconnectAfterCriticalError=s}destroy(){this._logNormal("Destroying session"),this._isConnected.unsubscribe(),this.disconnect(),this._sessionIdChanged.destroy(),delete this._chartApi,this._logNormal("Session has been destroyed")}isConnected(){return this._isConnected}sessionId(){return this._sessionId}onSessionIdChanged(){return this._sessionIdChanged}connect(){0===this._state&&((0,i.assert)(!this._isConnectForbidden,"Cannot call connect because it is forbidden at this moment"),this._setSessionId(`${this._sessionPrefix}_${(0,a.randomHash)()}`),this._logNormal("Connecting session - wait until transport stay connected"),this._state=1,this._chartApi.createSession(this._sessionId,this))}disconnect(){0!==this._state&&((0,i.assert)(""!==this._sessionId,"sessionId must not be invalid"),this._logNormal("Disconnecting session..."),this._forbidConnectWhile((()=>{this._chartApi.connected()&&this._sendRemoveSession(),this._processDestroyingOnServer()})))}onMessage(t){switch(t.method){case"connected":return void this._onChartApiConnected();case"disconnected":return void this._onChartApiDisconnected();case"critical_error":const e=String(t.params[0]),s=String(t.params[1]);return void this._onCriticalError(e,s)}this._onMessage(t)}serverTime(){return this._chartApi.serverTime()}_getChartApi(){return this._chartApi}_generateLogMessage(t){return`[${this._sessionId}] ${t}`}_onCriticalError(t,e){this._logError(`Critical error. Reason=${t}, info=${e}.`),this._forbidConnectWhile((()=>{this._processDestroyingOnServer()})),this._shouldReconnectAfterCriticalError?(this._logNormal("Reconnecting after critical error..."),this.connect()):this._logNormal("Reconnecting after critical error skipped")}_onChartApiConnected(){(0,i.assert)(1===this._state,"Session is not registered"),this._logNormal("Transport is connected. Creating session on the server"),this._sendCreateSession(),this._state=2,this._isConnected.setValue(!0)}_onChartApiDisconnected(){this._logNormal("Transport is disconnected. Reconnecting..."),this._forbidConnectWhile((()=>{this._processDestroyingOnServer()})),this.connect()}_setSessionId(t){const e=this._sessionId;this._logNormal(`Changing sessionId: old=${e}, new=${t}`),this._sessionId=t,this._sessionIdChanged.fire(t,e)}_logNormal(t){o.logNormal(this._generateLogMessage(t))}_logError(t){o.logError(this._generateLogMessage(t))}_processDestroyingOnServer(){this._state=0,this._isConnected.setValue(!1),this._chartApi.removeSession(this._sessionId),this._setSessionId("")}_forbidConnectWhile(t){this._isConnectForbidden=!0,t(),this._isConnectForbidden=!1}}},641208:(t,e,s)=>{function i(t,e,s){
return t===e||t===s}s.d(e,{symbolSameAsResolved:()=>i})},707771:(t,e,s)=>{s.d(e,{INVALID_TIME_POINT_INDEX:()=>i,UNPLOTTABLE_TIME_POINT_INDEX:()=>r});const i=-2e6,r=-1e6}}]);