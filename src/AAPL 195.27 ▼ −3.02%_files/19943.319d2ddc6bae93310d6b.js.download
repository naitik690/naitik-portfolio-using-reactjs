(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[19943,35844],{326352:e=>{e.exports={"css-value-chart-controls-bar-height-with-border":"39px","css-value-chart-controls-bar-border":"1px"}},796416:(e,t,n)=>{"use strict";n.d(t,{TOAST_ANIMATION_DURATION:()=>r});const r=500},587307:(e,t,n)=>{"use strict";n.d(t,{createActivityStatus:()=>s});var r=n(806660);function s(e,t){const n=new Set,s=new r.WatchedValue("hidden"!==document.visibilityState),o=t?.timers||{setTimeout,clearTimeout},i=o.setTimeout,a=o.clearTimeout;let l;const c=t?.ignoreVisibilityChange;s.subscribe((e=>{n.forEach((t=>t(!!e)))}),{callWithLast:!0});const u=()=>{s.setValue(!0),a(l),l=i((()=>{s.setValue(!1)}),e)},d=()=>{"hidden"===document.visibilityState?s.setValue(!1):u()};return{subscribe:t=>{n.size>0||(a(l),l=i((()=>{s.setValue(!1)}),e),document.addEventListener("click",u,{passive:!0}),document.addEventListener("mousemove",u,{passive:!0}),document.addEventListener("keydown",u,{passive:!0}),document.addEventListener("touchstart",u,{passive:!0}),document.addEventListener("wheel",u,{passive:!0}),c||document.addEventListener("visibilitychange",d,{passive:!0})),n.add(t)},unsubscribe:e=>{n.delete(e),0===n.size&&(document.removeEventListener("click",u),document.removeEventListener("mousemove",u),document.removeEventListener("keydown",u),document.removeEventListener("touchstart",u),document.removeEventListener("wheel",u),c||document.removeEventListener("visibilitychange",d),a(l))},value:()=>!!s.value()}}},936442:(e,t,n)=>{"use strict";n.d(t,{CHART_WARNINIG_GROUP_ID:()=>a,showChartWarningNotification:()=>l});var r=n(148255),s=n(779672),o=n(1368);const i=1e4,a="chart_warning";function l(e,t){return new Promise((n=>{s.toastManager.addToast(e,a,t),(0,o.setToastUserActivityBasedRemovalTimeout)(e,i);const l=(0,r.subscribeOnToast)(e,(e=>{"Remove"!==e.type&&e.details!==o.CLOSE_DUE_TO_INACTIVITY_EVENT_DETAILS||(n(),l())}))}))}},148255:(e,t,n)=>{"use strict";n.d(t,{subscribeOnToast:()=>r});const r=n(779672).toastManager.subscribeOnToast},1368:(e,t,n)=>{"use strict";n.d(t,{CLOSE_DUE_TO_INACTIVITY_EVENT_DETAILS:()=>o,setToastUserActivityBasedRemovalTimeout:()=>i});var r=n(779672),s=n(587307);const o="userActivityTimeout",i=function(e,t,n,r){const o=(0,s.createActivityStatus)(n);return function(n,s=2e4){const{start:i,reset:a}=function(e,t){let n;return{start:()=>{n=setTimeout(e,t)},reset:()=>{clearTimeout(n),n=void 0}}}((()=>{e.removeToast(n,r)}),s),l=()=>{const e=o.value(),n=t.value;e&&!n?i():a()};o.subscribe(l),l();const c=t.subscribe(l),u=e.subscribeOnToast(n,(e=>{"RemoveAnimationStart"===e.type&&(a(),u(),o.unsubscribe(l),c())}))}}(r.toastManager,r.toastUserInteractionStatus,15e3,o)},779672:(e,t,n)=>{"use strict";n.r(t),n.d(t,{toastManager:()=>s,toastUserInteractionStatus:()=>o});var r=n(796416);const s=function(){const e=new Set,t=new Map,n={groups:new Map};function s(e){const t=n.groups.get(e);if(t)return t;const r={id:e,list:new Map,added:new Set,removed:new Set};return n.groups.set(e,r),r}function o(e,r){t.delete(e),r.added.delete(e),
r.removed.delete(e),r.list.delete(e),0===r.list.size?n.groups.delete(r.id):n.groups.set(r.id,{...r}),i({type:"Remove",toastId:e,groupId:r.id})}function i(t){n.groups=new Map(n.groups),e.forEach((e=>{e(t)}));const r=a.get(t.toastId);r&&r.forEach((e=>{e(t)}))}const a=new Map;return{addToast:function(e,r,o,a,l){if(t.get(e))return;const c=s(r);c.added.add(e);const u={id:e,...o,manualAnimationStart:l};c.list.set(e,u),t.set(e,r),n.groups.set(r,{...c}),i({type:"Add",toastId:e,groupId:r,data:o,details:a})},removeToast:function(e,s){const a=t.get(e);if(!a)return;const l=n.groups.get(a);l&&(l.removed.has(e)||(l.removed.add(e),n.groups.set(a,{...l}),i({type:"RemoveAnimationStart",toastId:e,groupId:a,details:s}),setTimeout((()=>{o(e,l)}),r.TOAST_ANIMATION_DURATION)))},removeGroup:function(e,t){const s=n.groups.get(e);if(!s)return;const a=[];s.list.forEach((n=>{const r=n.id;s.removed.has(r)||(a.push(r),s.removed.add(r),i({type:"RemoveAnimationStart",toastId:r,groupId:e,details:t}))})),n.groups.set(e,{...s}),setTimeout((()=>{a.forEach((e=>{o(e,s)}))}),r.TOAST_ANIMATION_DURATION)},startAddAnimation:function(e){const r=t.get(e);if(!r)return;const s=n.groups.get(r);s&&s.added.delete(e)&&(n.groups.set(r,{...s}),i({type:"AddAnimationStart",toastId:e,groupId:r}))},subscribeOnToast:function(e,t){const n=function(e){const t=a.get(e);if(t)return t;const n=new Set;return a.set(e,n),n}(e);return n.add(t),()=>{n.delete(t),0===n.size&&a.delete(e)}},state:n,subscribe:function(t){return e.add(t),()=>{e.delete(t)}}}}(),o=function(){const e=new Set,t=new Set,n={update:function(r,s){r?t.add(s):t.delete(s);const o=t.size>0;n.value!==o&&(n.value=o,e.forEach((e=>{e(r)})))},value:!1,subscribe:function(t){return e.add(t),()=>{e.delete(t)}}};return n}()},474759:(e,t,n)=>{"use strict";function r(e){const t={};return e.sources&&(t.sources={},e.sources.forEach(((e,n)=>{t.sources[n]=e}))),t.drawing_groups={},e.groups.forEach(((e,n)=>{t.drawing_groups[n]=e})),t.clientId=e.clientId,JSON.stringify(t)}function s(e,t){const n={sources:null,groups:new Map};if(null!==e.sources){n.sources=new Map;for(const t in e.sources||{}){const r=e.sources[t];n.sources.set(t,r)}}for(const t in e.drawing_groups||{}){const r=e.drawing_groups[t];n.groups.set(t,r)}return null!==t&&(n.serverRequestId=t),n.clientId=e.clientId,n.symbol=e.symbol,n}n.d(t,{parseLineToolsAndGroupsDTO:()=>s,stringifyLineToolsAndGroupsDTO:()=>r})},652171:(e,t,n)=>{"use strict";n.d(t,{getStorageTarget:()=>l,globallySharedChartId:()=>a,sharedChartId:()=>i});var r=n(803912),s=n(175203),o=n(904653);const i="_shared",a="UserSync";async function l(e,t,n,a){try{const l=new URL("/chart-token/",location.href);l.searchParams.append("image_url",e),l.searchParams.append("user_id",String(window.user.id||-1));const c=await(0,r.fetch)(l.toString(),{signal:a});if(!c.ok)throw new Error(`Http response is not ok: ${c.status}}`);const u=await c.json();if(s.telemetry.sendLineToolsStorageReport("line_tools_token_request_success"),a?.aborted)throw(0,o.createAbortError)();const d=2===n?void 0:1===n?i:t;return{token:u.token,
chartId:d,path:2===n?"user/sources":`layout/${e}/sources`}}catch(e){throw(0,o.isAbortError)(e)||s.telemetry.sendLineToolsStorageReport("line_tools_token_request_error"),e}}},919943:(e,t,n)=>{"use strict";n.d(t,{applyIndicatorToAllChartsImpl:()=>be,applyIndicatorsToAllChartsImpl:()=>_e,applyLineToolUpdateNotificationImpl:()=>ve,applyStudiesOverrides:()=>xe,applyThemeImpl:()=>Le,chartsSymbolsImpl:()=>Se,copyScreenshotToClipboard:()=>Ee,createChartStorageSubscriptionsIfRequired:()=>Ie,createClipboardHandler:()=>we,createLeftBottomChartWidgetWV:()=>ke,downloadScreenshot:()=>Me,generateNewChartId:()=>Ne,getVisuallyAdjacentDefImpl:()=>Oe,handleConnectionLimitReachedChanged:()=>Ue,resetLayoutSizesImpl:()=>Re,setBrokerImpl:()=>Ce,setChartStyleToWidget:()=>We});var r=n(650151),s=n(444372),o=n(418450),i=n(745679),a=n(422063);class l extends a.UndoCommand{constructor(e,t){super(null),this._chartModel=e,this._targetIndex=t}redo(){const e=this._chartModel.createPane(this._targetIndex,void 0,this._paneId);this._paneId=e.id()}undo(){const e=(0,r.ensureDefined)(this._paneId),t=this._chartModel.panes().find((t=>t.id()===e));void 0!==t&&this._chartModel.removePane(t)}createdPaneId(){return this._paneId}}var c=n(172379),u=n(735566),d=n(927301),h=n(507458);const p=(0,u.getLogger)("Clipboard");class m{constructor(e){this._e=e}write(e){return(0,h.writeImpl)(this._toRaw(e),this._e)}_toRaw(e){const t={files:[]};t.text=e.text,void 0!==e.app?t.html=this._serializeAppData(e.app,e.text):e.html&&(t.html=e.html);for(const n of e.files||[])t.files.push(n);return t}_serializeAppData(e,t){return`<meta charset="utf-8"><span data-tradingview-clip="${(0,d.htmlEscape)(e)}">${t?(0,d.htmlEscape)(t.slice(0,256)):"&#128200;"}</span>`}}class f{constructor(e){this._e=e}async read(){this._e&&0===this._e.eventPhase&&(p.logWarn("Cannot use an already dispatched ClipboardEvent for reading"),this._e=null);const e=this._e?this._readUsingEvent(this._e):await this._readUsingApi();return this._fromRaw(e)}_readUsingEvent(e){const t=(0,r.ensure)(e.clipboardData);e.preventDefault();const n={files:[]};for(let e=0;e<t.files.length;e++)n.files.push(t.files[e]);for(let e=0;e<t.items.length;e++){const r=t.items[e];"string"===r.kind&&("text/plain"===r.type?n.text=t.getData(r.type):"text/html"===r.type?n.html=t.getData(r.type):n.files.push(new Blob([t.getData(r.type)],{type:r.type})))}return n}async _readUsingApi(){const e=(0,h.getClipboard)();if(!e||!e.read)throw new DOMException("ClipboardApi is not supported","NotSupportedError");let t,n;const r=[],s=await e.read();for(const e of s)for(const s of e.types)"text/html"===s?t=e.getType(s).then(this._readBlobAsText):"text/plain"===s?n=e.getType(s).then(this._readBlobAsText):r.push(e.getType(s));return{text:await n,html:await t,files:await Promise.all(r)}}_fromRaw(e){const t={};if(void 0!==e.text&&(t.text=e.text),void 0!==e.html){const n=this._parseAppData(e.html);n?t.app=n:t.html=e.html}return e.files.length>0&&(t.files=e.files),t}_parseAppData(e){if(-1===e.slice(0,1024).indexOf("data-tradingview-clip"))return
;const t=(new DOMParser).parseFromString(e,"text/html").querySelector("[data-tradingview-clip]");return t?t.getAttribute("data-tradingview-clip")||"":void 0}_readBlobAsText(e){return new Promise(((t,n)=>{const r=new FileReader;r.onloadend=()=>{t(r.result)},r.onerror=()=>{n(r.error)},r.readAsText(e)}))}}class g{constructor(e){this._callbacks=Object.assign({},e),this._boundOnCopy=this._onCopyEv.bind(this),this._boundOnCut=this._onCutEv.bind(this),this._boundOnPaste=this._onPasteEv.bind(this)}listen(){document.addEventListener("copy",this._boundOnCopy),document.addEventListener("cut",this._boundOnCut),document.addEventListener("paste",this._boundOnPaste)}async peek(){if("granted"!==(await navigator.permissions.query({name:"clipboard-read"})).state)throw new Error("clipboard-read is not granted");return new f(null).read()}uiRequestCopy(e){this._callbacks.copyRequested&&this._callbacks.copyRequested(new m(null),e)}uiRequestCut(e){this._callbacks.cutRequested&&this._callbacks.cutRequested(new m(null),e)}uiRequestPaste(e){this._callbacks.pasteRequested&&this._callbacks.pasteRequested(new f(null),e)}destroy(){document.removeEventListener("copy",this._boundOnCopy),document.removeEventListener("cut",this._boundOnCut),document.removeEventListener("paste",this._boundOnPaste)}_onCopyEv(e){e.defaultPrevented||this._callbacks.copyRequested&&this._callbacks.copyRequested(new m(e))}_onCutEv(e){e.defaultPrevented||this._callbacks.cutRequested&&this._callbacks.cutRequested(new m(e))}_onPasteEv(e){e.defaultPrevented||this._callbacks.pasteRequested&&this._callbacks.pasteRequested(new f(e))}}var _=n(515312);function y(e){const t=e.target;return null!==t&&1===t.nodeType&&(0,_.isTextEditingField)(t)}function b(e){const t=e.target;if(null===t)return!1;const n=(t.ownerDocument||t).getSelection();return null!==n&&!n.isCollapsed}class v extends g{_onCopyEv(e){if(!y(e)&&!b(e))return super._onCopyEv(e)}_onCutEv(e){if(!y(e)&&!b(e))return super._onCutEv(e)}_onPasteEv(e){if(!y(e))return super._onPasteEv(e)}}var T=n(921941),w=n(936442),C=n(470316),S=n(992467),I=n(925470),M=n(707934),E=n(867823),A=n(214258),k=n(175203),R=n(314802),O=n(680039),N=n(652171),L=n(474759),W=n(556466),U=n(550562),x=n(547465),D=n(125226),P=n(820028);const B=new Set(["chart_storage_hibernation_delay_60min","chart_storage_hibernation_delay_10min","chart_storage_hibernation_delay_5min"]);const V=new P.WatchedValue(z());function z(){return(0,D.isFeatureEnabled)("chart_storage_hibernation_delay_60min")?36e5:(0,D.isFeatureEnabled)("chart_storage_hibernation_delay_10min")?6e5:(0,D.isFeatureEnabled)("chart_storage_hibernation_delay_5min")?3e5:6e4}(0,D.onFeaturesStateChanged)().subscribe(null,(e=>{if(!function(e){return B.has(e)}(e))return;const t=z();V.setValue(t,!1)}));const H=V.readonly();var q=n(638456);function F(e){const t=document.querySelector('link[rel~="chart-storage-notifications"]');return t?.href?e?new URL(e,t.href):new URL(t.href):null}function j(e,t){return Boolean(e.metaInfo.uid.value())&&!t.containsData&&!t.onWidget&&function(){if(!(0,
R.isOnMobileAppPage)("new"))return!0;const e=/TradingView\/(\d+)\.(\d+)\.(\d+)\.?/.exec(navigator.userAgent);if(null===e)return!0;const t=Number(e[1])-1,n=Number(e[2])-15,r=Number(e[3])-0;if(t>0||0===t&&n>0||0===t&&0===n&&r>0)return!0;return!1}()&&null!==F()}const $=(0,u.getLogger)("ChartStorageChangesSubscription");class G extends O.PersistentEventSourceTransport{constructor(e,t){super((e=>this._onMessage(e))),this._destroyed=!1,this._onChangeVisibilityBound=this._onChangeVisibility.bind(this),this._hibernateTimerId=null,this._hibernateDelay=H.spawn(),this._beforeUnhibernating=new x.Delegate,this._haveEverBeenHibernated=!1,this._fireBeforeUnhibernatingOnReconnect=!1,this._fireBeforeUnhibernatingOnReconnectTimerId=0,this._chartWidgetsCollection=e,this._layoutVisibility=e.resizerBridge().visible.spawn(),this._layoutVisibility.subscribe(this._onChangeVisibilityBound,{callWithLast:!0}),k.telemetry.sendLineToolsStorageReport("line_tools_subscription_initial_connect"),this._connectionStatus.subscribe((e=>{e===W.ConnectionStatus.Closed&&k.telemetry.sendLineToolsStorageReport("line_tools_subscription_disconnected")})),this._subscribeForSharingLayout=t,this.connect(),this._hibernateDelay.subscribe((e=>{null!==this._hibernateTimerId&&this._scheduleHibernation(e)}))}destroy(){this._layoutVisibility.destroy(),this._hibernateDelay.destroy(),this.disconnect(),this._destroyed=!0}beforeUnhibernating(){return this._beforeUnhibernating}async _prepareParamsForConnection(e){const t=this._chartWidgetsCollection.metaInfo.uid.value();if(this._destroyed)return Promise.reject("Subscription is being destroyed");const n=await(0,N.getStorageTarget)(t,"",0),r=F(`/charts-storage/layout/${t}/subscribe`);null!==r?(r.searchParams.delete("jwt"),r.searchParams.append("jwt",n.token),this._subscribeForSharingLayout&&window.user.id&&window.user.is_pro&&r.searchParams.append("id",""+window.user.id),this._url=r.toString()):this._url=""}_tryReconnectImpl(){super._tryReconnectImpl(),k.telemetry.sendLineToolsStorageReport("line_tools_subscription_reconnecting")}_onOpenCallback(){super._onOpenCallback(),this._fireBeforeUnhibernatingOnReconnect&&($.logNormal("Unhibernating on reconnect"),this._beforeUnhibernating.fire(),this._fireBeforeUnhibernatingOnReconnect=!1,clearTimeout(this._fireBeforeUnhibernatingOnReconnectTimerId),this._fireBeforeUnhibernatingOnReconnectTimerId=0)}_onMessage(e){if("string"!=typeof e)throw new Error("Wrong message type, expected string");const t=JSON.parse(e);Object.entries(t).forEach((e=>{const t=(0,L.parseLineToolsAndGroupsDTO)(e[1],""),n=e[0];let r=0;n===N.sharedChartId?r=1:n===N.globallySharedChartId&&(r=2),this._chartWidgetsCollection.applyLineToolUpdateNotification(n,t,r)}))}_onChangeVisibility(){const e=this._layoutVisibility.value();$.logNormal(`Visibility changed to ${e}, connection status: ${this.connectionStatus().value()}`),e?this.connectionStatus().value()!==W.ConnectionStatus.Open?(this.connectionStatus().value()===W.ConnectionStatus.Closed&&this.connect(),this._beforeUnhibernating.fire(),
this._haveEverBeenHibernated&&($.logNormal("Connect due to becoming visible"),k.telemetry.sendLineToolsStorageReport("line_tools_unhibenate_subscription"))):((0,R.isOnMobileAppPage)("any")||q.CheckMobile.iOS()||q.CheckMobile.Android())&&($.logNormal("Schedule unhibernating on reconnect"),this._fireBeforeUnhibernatingOnReconnect=!0,clearTimeout(this._fireBeforeUnhibernatingOnReconnectTimerId),this._fireBeforeUnhibernatingOnReconnectTimerId=setTimeout((()=>{$.logNormal("Cancel Scheduled unhibernating on reconnect"),this._fireBeforeUnhibernatingOnReconnect=!1}),5e3)):e||this._scheduleHibernation(H.value())}_scheduleHibernation(e){null!==this._hibernateTimerId&&U.workerBasedTimers.clearTimeout(this._hibernateTimerId),this._hibernateTimerId=U.workerBasedTimers.setTimeout((()=>this._disconnectIfInvisible()),e)}_disconnectIfInvisible(){this._hibernateTimerId=null,this._layoutVisibility.value()||($.logNormal("Disconnect due to becoming invisible"),this.disconnect(),k.telemetry.sendLineToolsStorageReport("line_tools_hibenate_subscription"),this._haveEverBeenHibernated=!0)}}var K=n(388741),Y=n(308721),J=n(251954),Q=n(981649),X=n(89954),Z=n(909740);const ee=new o.TranslatedString("apply toolbars theme",s.t(null,void 0,n(686708)));class te extends a.UndoCommand{constructor(e,t,n=!0){super(ee),this._prevThemeName=e,this._themeName=t,this._syncState=n}undo(){(0,Y.isStdThemeName)(this._prevThemeName)&&((0,Z.setTheme)(this._prevThemeName),this._syncState&&(0,Y.syncTheme)())}redo(){(0,Y.isStdThemeName)(this._themeName.toLowerCase())&&((0,Z.setTheme)(this._themeName.toLowerCase()),this._syncState&&(0,Y.syncTheme)())}}var ne=n(68777),re=n(582441),se=n(477786),oe=n(779923),ie=n(87347),ae=n(807958);n(326352);const le=new o.TranslatedString("apply indicators to entire layout",s.t(null,void 0,n(870507))),ce=new o.TranslatedString("reset layout sizes",s.t(null,void 0,n(385366))),ue=new o.TranslatedString("apply chart theme",s.t(null,void 0,n(368231))),de=s.t(null,void 0,n(328298)),he=s.t(null,void 0,n(978972)),pe=s.t(null,void 0,n(410615)),me=s.t(null,void 0,n(981518)),fe=s.t(null,void 0,n(892101)),ge=s.t(null,void 0,n(294656));function _e(e,t){const n=t.model().model().studyTemplate();e.undoHistory.beginUndoMacro(le);for(let r=0;r<e.chartWidgetsDefs.length;r++){const s=e.chartWidgetsDefs[r].chartWidget;s!==t&&(s.hasModel()&&s.model().applyStudyTemplate(n,""))}e.undoHistory.endUndoMacro()}function ye(e,t){for(const n of e.sources){if("study"!==n.type)return!0;if(t.checkIfFeatureAvailable(new ae.StudyMetaInfo(n.source.metaInfo),[]))return!0}return!1}async function be(e,t,n,s,o){e.undoHistory.beginUndoMacro(o);for(let i=0;i<e.chartWidgetsDefs.length;i++){const a=e.chartWidgetsDefs[i].chartWidget;if(a!==t&&a&&a.hasModel()){const t=a.model();if(!ye(n,t))continue;let i;if(s.isOnMainPane)i=(0,r.ensureNotNull)(t.model().paneForSource(a.model().model().mainSeries()));else{const n=new l(t.model(),s.paneIndex);e.undoHistory.pushUndoCommand(n);const o=(0,r.ensureDefined)(n.createdPaneId());i=(0,r.ensureDefined)(t.model().panes().find((e=>e.id()===o)))
}const c=await t.pasteSourceFromClip(i,n,!0);if(c&&1===c.length){const e=c[0];if(s.asCompare){const n=(0,r.ensureNotNull)(t.mainSeries().priceScale());t.moveToScale(e,(0,r.ensureDefined)(i),n,o),t.setPriceScaleMode({percentage:!0},n,null)}}t.model().lightUpdate()}}e.undoHistory.endUndoMacro()}async function ve(e,t,n,r){const s=e.map((e=>e.chartWidget)).filter((e=>e.hasModel())).filter((e=>e.id()===t||0!==r));try{s.forEach((e=>e.startApplyingLineToolUpdateNotification()));for(const e of s)await e.model().model().withoutLineToolsSyncAction((()=>e.applyLineToolUpdateNotification(n,r)))}finally{s.forEach((e=>e.endApplyingLineToolUpdateNotification()))}}function Te(e){return e instanceof Error?e.message:null}function we(e){return new v({copyRequested:(t,n)=>{e.activeChartWidget.value().model().clipboardCopy(t,n).catch((e=>{const t=Te(e)??de.format({keystroke:(0,C.humanReadableHash)(C.Modifiers.Mod+67)});(0,w.showChartWarningNotification)("copy",{title:he,text:t})}))},cutRequested:(t,n)=>{e.activeChartWidget.value().model().clipboardCut(t,n).catch((e=>{const t=Te(e)??de.format({keystroke:(0,C.humanReadableHash)(C.Modifiers.Mod+88)});(0,w.showChartWarningNotification)("cut",{title:pe,text:t})}))},pasteRequested:(t,n)=>{if(n?.mode()===i.PaneMode.Widget)return;(n?n.model().undoModel():e.activeChartWidget.value().model()).clipboardPaste(t,n).catch((e=>{const t=Te(e)??de.format({keystroke:(0,C.humanReadableHash)(C.Modifiers.Mod+86)});(0,w.showChartWarningNotification)("paste",{title:me,text:t})}))}})}function Ce(e,t){(0,S.setBroker)(t)}function Se(e){const t={};return e.chartWidgetsDefs.map((e=>e.chartWidget)).forEach((e=>t[e.id()]=function(e){const t={};if(!e.hasModel()){const n=e.options().content;if(!n)return t;const s=(0,r.ensureNotNull)(n.panes.reduce(((e,t)=>e??t.sources.find((e=>"MainSeries"===e.type))??null),null));return t.resolution=s.state?.interval,t.symbol=s.state?.symbol,t.short_name=s.state?.shortName,t}const n=e.model().mainSeries(),s=n.properties().childs(),o=n.symbolInfo();t.resolution=s.interval.value(),t.symbol_type=null!==o&&o.type||"",t.exchange=null!==o&&o.exchange||"",t.listed_exchange=null!==o&&o.listed_exchange||"";const i=o?.legs??[];if(null!==o&&n.isSpread()){const e=i[0];let n=o.base_name[0];n=n.split(":")[1],t.symbol=e,t.short_name=n,t.expression=o.full_name}else t.symbol=null!==o&&o.ticker||s.symbol.value(),t.short_name=s.shortName.value();const a=o?.base_name??[];return t.legs=i.map(((e,t)=>({symbol:e,pro_symbol:a[t]}))),t}(e))),t}function Ie(e,t){if(j(e,t.widgetOptions)){const n=new G(e,!e.readOnly());n.beforeUnhibernating().subscribe(e,(()=>{!function(e){e.chartWidgetsDefs.map((e=>e.chartWidget)).forEach((e=>e.reloadAllLineTools()))}(t)})),t.setChartStorageNotificationSubscription(n)}}function Me(e){return T.downloadClientScreenshot(e)}function Ee(e){return T.copyToClipboardClientScreenshot(e).then((()=>{(0,J.emit)("onClientScreenshotCopiedToClipboard")}))}const Ae={s:0,"2h":0,"2v":1,"3h":0,"3v":2,"3s":0,"3r":1,"2-1":1,"1-2":1,4:1,"4v":3,"4h":0,"4s":0,"4s-l":0,"1-3":1,"3-1":3,"2-2-l":0,
"2-2-r":1,"2-2":3,"1-4":1,"5h":0,"5v":0,"5s":0,"5s-l":0,"2-3":2,"3-2":3,"4-1":4,"2-3-l":0,"2-3-r":2,6:1,"6h":0,"6v":0,"6c":4,"2-4":2,"4-2":4,"4-3":4,"7h":0,"7s":0,8:1,"8c":6,"8h":0,"8v":0,"9s":6,"5-4":5,"9h":0,"9v":0,"10c5":1,"10h":0,"10v":0,"12c6":1,"12c4":3,"12h":0,"14c7":1,"16c8":1,"16c4":3};function ke(e,t,n,r){let s=0;const o=(0,re.createWVFromGetterAndSubscriptions)((()=>++s),[n,r]);return(0,ne.combine)(((t,n)=>e()[Ae[t]]??null),t.weakReference(),o.ownership())}function Re(e,t){!function(e,t){const n=(0,Q.layoutInitialSizingState)(e.layoutTemplate.value().expression),r=e.layoutTemplate.value().layoutType,s=t=>t?e.allLayoutSizesState.set(r,t):e.allLayoutSizesState.delete(r);if(t)return e.sizingState.setValue(n),void s(n);e.undoHistory.beginUndoMacro(ce),e.undoHistory.pushUndoCommand(new c.SetWatchedValueUndoCommand(e.sizingState,e.sizingState.value(),n,ce)),e.undoHistory.pushUndoCommand(new X.ValueSwitcherUndoCommand(s,e.allLayoutSizesState.get(e.layoutTemplate.value().layoutType),n,ce)),e.undoHistory.endUndoMacro()}(e,t)}function Oe(e,t,n){const r=e.chartWidgetsDefs.slice(0,e.layoutTemplate.value().count).map(((t,n,r)=>({def:t,metrics:e.layoutTemplate.value().sizer({top:0,left:0,width:256,height:256},n,r.length,0)}))).sort(((e,t)=>e.metrics.top-t.metrics.top||e.metrics.left-t.metrics.left)).map((e=>e.def));if(r.length<2)return null;let s=r.indexOf(t);return-1===s?null:(s=(s+(n?r.length-1:1))%r.length,r[s])}function Ne(e){let t=1;for(;e(""+t);)t++;return""+t}async function Le(e,t,n){const{theme:r,onlyActiveChart:s,restoreNonThemeDefaults:o,themeName:i,standardTheme:a,syncState:l=!0,noUndo:c}=n,u=(0,Y.getCurrentTheme)().name;let d;s?d=[e.activeChartWidget.value()]:(await Promise.all(e.savedChartWidgetOptions.map(((e,t)=>t)).map((t=>new Promise((n=>{const r=function(e,t,n){return e.addNewChartWidget(t,n)}(e,t,n);e.hideChart(r)}))))),d=e.chartWidgetsDefs.map((e=>e.chartWidget))),c?(a&&new te(u,i,l).redo(),d.forEach((e=>{e.model().model().restoreTheme(r,o,c)}))):(e.undoHistory.beginUndoMacro(ue),a&&e.undoHistory.pushUndoCommand(new te(u,i,l)),d.forEach((e=>{e.model().model().restoreTheme(r,o)})),e.undoHistory.endUndoMacro()),await Promise.all(d.map((e=>e.model().model().colorStudiesPropertiesReady())))}async function We(e,t=this.activeChartWidget.value()){if(!t)return!1;{if(se.Interval.isTicks(t.resolutionWV().value())&&(4===e||7===e||5===e||6===e))return t.showHint(1,{text:ge.format({chartStyle:(0,K.getTranslatedChartStyleName)(e)}),solutionId:A.solutionIds.WHY_RENKO_NOT_WORK,solutionText:s.t(null,void 0,n(744955))}),!1;let o=!1;const i=((r=this.innerState()).intervalLock.value()?r.chartWidgetsDefs.map((e=>e.chartWidget)):[r.activeChartWidget.value()]).filter((e=>e.hasModel()));for(const t of i){const n=t.model().model();if(n.isInReplay().value()&&!n.mainSeries().isStyleSupported(e)){o=!0;break}}const a=this.innerState().flags;return!o||a.isConfirmationAboutReplayLocked?(this.setChartStyle(t,e),!0):new Promise((n=>{(0,oe.showConfirm)({text:fe,onConfirm:r=>{a.isConfirmationAboutReplayLocked=!0,
this.setChartStyle(t,e),a.isConfirmationAboutReplayLocked=!1,r.dialogClose(),n(!0)},onClose:()=>n(!1),onCancel:e=>{e.dialogClose(),n(!1)}})}))}var r}function Ue(e){if(e){const e=function(){const e=(0,I.getConfig)("BACKEND_CONNECTIONS")?.limit??0,t=(0,r.ensureDefined)(window.pro),n=t.getProductsByType(t.PRODUCT_TYPES.pro_plan);for(const t of n)if(((0,I.getConfig)("BACKEND_CONNECTIONS",(0,r.ensureDefined)(t.id))?.limit??0)>e)return{connectionCount:e,moreConnectionsPlanAvailable:!0};return{connectionCount:e,moreConnectionsPlanAvailable:!1}}(),t=[{text:s.t(null,void 0,n(906186)),action:E.PredefinedAction.Close,variant:"secondary",color:"gray",compactMode:!0,onClick:()=>window.ChartApiInstance.connect()}];e.moreConnectionsPlanAvailable&&t.push({action:E.PredefinedAction.OpenGopro,text:s.t(null,void 0,n(987780)),compactMode:!0}),(0,M.createGoProDialog)({feature:"connectionsLimit",actionButtonsLayout:t.length>1?E.ActionButtonsLayout.Row:E.ActionButtonsLayout.Column,actions:t,customParams:e})}}function xe(e){ae.StudyMetaInfo.mergeDefaultsOverrides(e),(0,ie.studyMetaInfoRepository)().isReady()&&ae.StudyMetaInfo.overrideDefaults((0,ie.studyMetaInfoRepository)().getInternalMetaInfoArray())}},981649:(e,t,n)=>{"use strict";n.d(t,{createLayout:()=>c,layoutInitialSizingState:()=>u});var r=n(569708),s=n(154834),o=n(650151);const i=12,a=.05;function l(e,t,n,c=i){const u=new Set;if((0,r.default)(e))return u.add(e),{indices:u,smallestIndex:e,sizer:e=>e,splitters:()=>[],resizeApplier:(e,t,n,r,s)=>s,syncSublayoutsBySplitter:(e,t)=>t};const[h,...p]=e,m=p.map((e=>l(e,t)));let f=1/0;for(const e of m)for(const t of Array.from(e.indices))t<f&&(f=t),u.add(t);const g=(e,t,n,r,s,o,i,a)=>{const{left:l,top:c,width:u,height:h}=e,p="h"===i?u:h,m=p-n*(o-1);a||(r=(s=1/o)*t);const f=r*m+t*n,g=Math.round(f),_=t===o-1?p-g:Math.round(f+s*m)-g;return"h"===i?d(l+g,c,_,h):d(l,c+g,u,_)},_=(e,t,n,s,o,i,a)=>{if((0,r.default)(n))return[];const[l,...u]=n;return u.reduce((({sumOfCoeffsBefore:n,splitters:r},h,p)=>{const m=a?.[p],f=m?.percent??1/u.length,y=g(e,p,t,n,f,u.length,l,a);if(p<u.length-1){const e=`${i}-${s}-${p}-${l}`,{left:t,top:n,width:a,height:u}=y,h="v"===l?d(t,n+u-c/2+1,a,c):d(t+a-c/2+1,n,c,u);r.push({level:s,orientation:l,indexes:[...o,p],metrics:h,className:e})}return{splitters:Array.isArray(h)?r.concat(_(y,t,h,s+1,[...o,p],i,m?.substate)):r,sumOfCoeffsBefore:n+f}}),{splitters:[],sumOfCoeffsBefore:0}).splitters};function y(e,t,n,s,i,l,c,u,d=a){if((0,r.default)(s))return l;const[,...p]=s;if(c<i.level){const s=[0];for(let e=0;e<p.length;e++)s.push(s[s.length-1]+l[e].percent);return p.map(((a,m)=>{const f=l[m];if((0,r.default)(a))return f;if(!u&&m!==i.indexes[c])return f;const _=f?.percent??1/p.length,b=g(e,m,t,s[m],_,p.length,h,l);return{percent:f.percent,substate:y(b,t,n,a,i,(0,o.ensureDefined)(f.substate),c+1,u,d)}}))}{const[t]=s;if(t!==i.orientation||l.length<2)return l;const r=Math.min(i.indexes[c],l.length-2),o="v"===t?e.height:e.width,a=n/o,u=l[r].percent+l[r+1].percent;return l[r].percent+=a,l[r].percent=Math.min(u-d,Math.max(d,l[r].percent)),
l[r+1].percent-=a,l[r+1].percent=Math.min(u-d,Math.max(d,l[r+1].percent)),l}}function b(e,t){if(1===e.length)return t;{const[n,...r]=e;return b(r,(0,o.ensureDefined)(t[n].substate))}}function v(e,t,n,i,a){if((0,r.default)(e))return n;const[,...l]=e;if(a<t.level)return l.map(((e,s)=>{const l=n?.[s];return(0,r.default)(e)?l:{percent:l.percent,substate:v(e,t,(0,o.ensureDefined)(l.substate),i,a+1)}}));{const e=t.indexes[a];if(i.length<n.length){const e=(0,s.default)(i),t=e[e.length-1].percent,r=n.length-e.length,o=t/(r+1);e[e.length-1].percent=o;for(let t=0;t<r;t++)e.push({percent:o});i=e}else if(i.length>n.length){const t=(0,s.default)(i);if(e>=n.length-1){const e=i.length-n.length;for(let n=0;n<e;n++)t[e].percent+=t[n].percent;t.splice(0,e)}else{for(let e=n.length;e<i.length;e++)t[n.length-1].percent+=t[e].percent;t.splice(n.length)}i=t}return n.forEach(((e,t)=>e.percent=i[t].percent)),n}}return{indices:u,smallestIndex:f,sizer:(e,t,n,r,s)=>{let o,i,a,l=0,c=0,u=0;for(let e=0;e<m.length;e++){const r=m[e];r.smallestIndex>=n||(r.indices.has(t)&&(o=r,a=s?.[e].substate,s&&(u=s[e].percent),i=l),l++,s&&0===u&&(c+=s[e].percent))}const d=g(e,i,r,c,u,l,h,s);return o.sizer(d,t,n,r,a)},splitters:(t,n,r)=>_(t,n,e,0,[],"",r),resizeApplier:(t,n,r,s,o,i,a)=>y(t,n,r,e,s,o,0,i,a),syncSublayoutsBySplitter:function(t,n){const r=b(t.indexes,n);return v(e,t,n,r,0)}}}function c(e,t,n,r){const s=l(e,t,0,r);return{title:n,count:s.indices.size,sizer:s.sizer,splitters:s.splitters,resizeApplier:s.resizeApplier,syncSublayoutsBySplitter:s.syncSublayoutsBySplitter,expression:e,layoutType:t}}function u(e){const[,...t]=e;return function(e){const t=1/e.length;return e.map((e=>({percent:t,substate:(0,r.default)(e)?void 0:u(e)})))}(t)}function d(e,t,n,r){return{left:e,top:t,width:n,height:r}}},921941:(e,t,n)=>{"use strict";n.d(t,{copyToClipboardClientScreenshot:()=>i,copyToClipboardImageOfChart:()=>s,downloadClientScreenshot:()=>a,getImageOfChartSilently:()=>o});const r=()=>Promise.all([n.e(96330),n.e(54389)]).then(n.bind(n,798397));function s(e,t={}){return r().then((n=>n.copyToClipboardImageOfChart(e,t)))}function o(e,t={}){return r().then((n=>n.getImageOfChartSilently(e,t)))}function i(e){return r().then((t=>t.copyToClipboardClientScreenshot(e)))}function a(e){return r().then((t=>t.downloadClientScreenshot(e)))}},745679:(e,t,n)=>{"use strict";var r;n.d(t,{PaneMode:()=>r}),function(e){e[e.Regular=0]="Regular",e[e.Widget=1]="Widget"}(r||(r={}))},172379:(e,t,n)=>{"use strict";n.d(t,{SetWatchedValueUndoCommand:()=>s});var r=n(89954);class s extends r.ValueSwitcherUndoCommand{constructor(e,t,n,r,s=!0){super((e=>this._vwState.setValue(e)),t,n,r,s),this._vwState=e}}},89954:(e,t,n)=>{"use strict";n.d(t,{ValueSwitcherUndoCommand:()=>s});var r=n(422063);class s extends r.UndoCommand{constructor(e,t,n,r,s=!0){super(r,void 0,s),this._setter=e,this._oldValue=t,this._newValue=n}redo(){this._setter(this._newValue)}undo(){this._setter(this._oldValue)}}},550562:(e,t,n)=>{"use strict";n.d(t,{workerBasedTimers:()=>o});var r=n(904653),s=n(430518);const o=new class{
constructor(){this._timerWorker=null,this._timerIdCounter=1,this._timersMap=new Map,this._rejectsToCall=new Set,this._processMessage=e=>{const t=this._timersMap.get(e.data.turnaround);switch(e.data.type){case"timerCreated":t&&(t.scheduledForRemoving?("interval"===t.type?this._getTimerWorker().postMessage({type:"clearInterval",id:e.data.id}):this._getTimerWorker().postMessage({type:"clearTimeout",id:e.data.id}),this._deleteTimerFromMap(e.data.turnaround)):t.workerTimerId=e.data.id);break;case"timerFired":t&&(t.callback(),"timeout"===t.type&&this._deleteTimerFromMap(e.data.turnaround))}}}destroy(){this._rejectsToCall.forEach((e=>e((0,r.createAbortError)()))),this._timerWorker?.terminate(),this._timerWorker=null,this._timersMap.clear()}setTimeout(e,t){return this._setTimeoutImpl(e,t,"timeout")}clearTimeout(e){const t=this._timersMap.get(e);t&&(t.workerTimerId?(this._getTimerWorker().postMessage({type:"clearTimeout",id:t.workerTimerId}),this._deleteTimerFromMap(e)):t.scheduledForRemoving=!0)}setInterval(e,t){const n=this._nextTimerId();return this._timersMap.set(n,{callback:e,type:"interval"}),this._getTimerWorker().postMessage({type:"setInterval",delay:t,turnaround:n}),n}clearInterval(e){const t=this._timersMap.get(e);t&&(t.workerTimerId?(this._getTimerWorker().postMessage({type:"clearInterval",id:t.workerTimerId}),this._deleteTimerFromMap(e)):t.scheduledForRemoving=!0)}async createTimeout(e,t){let n;return new Promise(((s,o)=>{n=o,this._rejectsToCall.add(n);const i=this.setTimeout(s,e);t?.signal?.addEventListener("abort",(()=>{this.clearTimeout(i),o((0,r.createAbortError)())}))})).finally((()=>{this._rejectsToCall.delete(n)}))}async*createInterval(e,t){let n=()=>{},s=e=>{};const o=this.setInterval((()=>{n()}),e);t.signal.addEventListener("abort",(()=>{this.clearInterval(o),s((0,r.createAbortError)())}));try{for(;;)await new Promise(((e,t)=>{n=e,this._rejectsToCall.delete(s),s=t,this._rejectsToCall.add(s)})),yield}catch(e){if(!(0,r.isAbortError)(e))throw e}}_getTimerWorker(){return null===this._timerWorker&&(this._timerWorker=new s.Worker(new URL(n.p+n.u(77050),n.b),{name:"Timer worker"}),this._timerWorker.onmessage=this._processMessage),this._timerWorker}_setTimeoutImpl(e,t,n){const r=this._nextTimerId();return this._timersMap.set(r,{callback:e,type:n}),this._getTimerWorker().postMessage({type:"setTimeout",delay:t,turnaround:r}),r}_deleteTimerFromMap(e){if(this._timersMap.delete(e),0===this._timersMap.size){const e=this._setTimeoutImpl((()=>{1===this._timersMap.size&&this._timersMap.has(e)&&(this._timersMap.delete(e),this._timerWorker?.terminate(),this._timerWorker=null)}),6e4,"terminal_timer")}}_nextTimerId(){return this._timerIdCounter++}}}}]);